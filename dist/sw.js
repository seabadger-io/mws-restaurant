"use strict";function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}var currentCache="mws-static-v1",currentImgCache="mws-images-v1",currentCaches=[currentCache,currentImgCache];self.addEventListener("fetch",function(n){_newArrowCheck(this,this);var e=new URL(n.request.url),t=n.request.clone();-1<["POST","PUT","DELETE"].indexOf(n.request.method.toUpperCase())?n.respondWith(fetch(n.request).then(function(e){return _newArrowCheck(this,this),e.clone().json().then(function(e){var t,n;_newArrowCheck(this,this),"restaurant_id"in e?(t=e.restaurant_id,n="review"):(t=e.id,n="restaurant"),sendCacheNotification({target:n,id:t})}.bind(this)),e}.bind(this)).catch(function(n){return _newArrowCheck(this,this),sendRequestNotification(t),new Promise(function(e,t){_newArrowCheck(this,this),t("API request failed",n)}.bind(this))}.bind(this))):e.pathname.match("^/(restaurants|reviews)")||(e.pathname.match(/\.jpg$/i)?n.respondWith(servePhoto(n.request)):n.respondWith(caches.match(n.request).then(function(e){return _newArrowCheck(this,this),e||fetch(n.request).then(function(t){return _newArrowCheck(this,this),200===t.status?caches.open(currentCache).then(function(e){return _newArrowCheck(this,this),e.put(n.request,t.clone()),t}.bind(this)):t}.bind(this)).catch(function(e){return _newArrowCheck(this,this),new Response("The requested resource is currently not available, please try again later",{status:404,statusText:e.message})}.bind(this))}.bind(this))))}.bind(void 0)),self.addEventListener("install",function(e){_newArrowCheck(this,this);var t=["/","/js/mainbundle.js","/js/detailsbundle.js","/restaurant.html","/index.html","/css/mainstyles.css","/css/detailsstyles.css"];e.waitUntil(caches.open(currentCache).then(function(e){_newArrowCheck(this,this),e.addAll(t)}.bind(this)))}.bind(void 0)),self.addEventListener("activate",function(e){_newArrowCheck(this,this),e.waitUntil(caches.keys().then(function(e){return _newArrowCheck(this,this),Promise.all(e.filter(function(e){return _newArrowCheck(this,this),e.startsWith("mws-")&&-1===currentCaches.indexOf(e)}.bind(this)).map(function(e){return _newArrowCheck(this,this),caches.delete(e)}.bind(this)))}.bind(this)))}.bind(void 0)),self.servePhoto=function(n){_newArrowCheck(this,this);var i=n.url.replace(/\@\d+\.jpg$/,"");return caches.open(currentImgCache).then(function(t){return _newArrowCheck(this,this),t.match(i).then(function(e){return _newArrowCheck(this,this),e||fetch(n).then(function(e){return _newArrowCheck(this,this),t.put(i,e.clone()),e}.bind(this))}.bind(this))}.bind(this))}.bind(void 0),self.sendCacheNotification=function(t){_newArrowCheck(this,this),self.clients.matchAll().then(function(e){_newArrowCheck(this,this),e.forEach(function(e){_newArrowCheck(this,this),e.postMessage({message:"cache_refresh",cacheinfo:t})}.bind(this))}.bind(this))}.bind(void 0),self.sendRequestNotification=function(n){_newArrowCheck(this,this),new Promise(function(t){_newArrowCheck(this,this),n.json().then(function(e){_newArrowCheck(this,this),t({url:n.url,method:n.method,body:e})}.bind(this)).catch(function(){_newArrowCheck(this,this),t({url:n.url,method:n.method})}.bind(this))}.bind(this)).then(function(t){_newArrowCheck(this,this),self.clients.matchAll().then(function(e){_newArrowCheck(this,this),e.forEach(function(e){_newArrowCheck(this,this),e.postMessage({message:"request_failed",request:t})}.bind(this))}.bind(this))}.bind(this))}.bind(void 0);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN3LmpzIl0sIm5hbWVzIjpbImN1cnJlbnRDYWNoZSIsImN1cnJlbnRJbWdDYWNoZSIsImN1cnJlbnRDYWNoZXMiLCJzZWxmIiwiZXZlbnQiLCJfbmV3QXJyb3dDaGVjayIsInRoaXMiLCJhZGRFdmVudExpc3RlbmVyIiwicmVxdWVzdCIsImNsb25lIiwicmVxdWVzdFVybCIsImluZGV4T2YiLCJyZXF1ZXN0Q29weSIsInJlc3BvbmRXaXRoIiwiZmV0Y2giLCJ0aGVuIiwicmVzcG9uc2UiLCJ0YXJnZXQiLCJqc29uIiwibWV0aG9kIiwicmVzcG9uc2VkYXRhIiwiaWQiLCJzZW5kQ2FjaGVOb3RpZmljYXRpb24iLCJiaW5kIiwiY2F0Y2giLCJlcnJvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwibWF0Y2giLCJwYXRobmFtZSIsInNlcnZlUGhvdG8iLCJjYWNoZXMiLCJzdGF0dXMiLCJvcGVuIiwiY2FjaGUiLCJzdGF0dXNUZXh0IiwiY2FjaGVkVXJscyIsIndhaXRVbnRpbCIsImFkZEFsbCIsImFsbCIsImNhY2hlTmFtZXMiLCJmaWx0ZXIiLCJjYWNoZU5hbWUiLCJzdGFydHNXaXRoIiwibWFwIiwic3RvcmFnZVVybCIsInVybCIsInJlcGxhY2UiLCJkZWxldGUiLCJuZXR3b3JrUmVzcG9uc2UiLCJwdXQiLCJkYXRhIiwiY2xpZW50cyIsImZvckVhY2giLCJjbGllbnQiLCJwb3N0TWVzc2FnZSIsIm1lc3NhZ2UiLCJjYWNoZWluZm8iLCJzZW5kUmVxdWVzdE5vdGlmaWNhdGlvbiIsImJvZHkiLCJyZXF1ZXN0RGF0YSIsIm1hdGNoQWxsIl0sIm1hcHBpbmdzIjoiK0dBQUEsSUFBTUEsYUFBZSxnQkFDZkMsZ0JBQWtCLGdCQUVsQkMsZUFBaUJGLGFBQWNDLGlCQUZyQ0UsS0FBTUYsaUJBQWtCLFFBQUEsU0FBQUcsR0FBeEJDLGVBQUFDLEtBQUFBLE1BRUEsSUFBTUosRUFBaUJGLElBQUFBLElBQUFBLEVBQWNDLFFBQUFBLEtBRWhDTSxFQUFpQkgs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LEVBQUFDLGFBK0JVQyxRQUFTLGlCQXBCZEUsUUFBQUEsS0FWSHBDLEtBQUFqQixRQU1HaUIsS0FBQWpCLFFBVkZpQixLQUFBakIsUUFERWlCLFVBQUEiLCJmaWxlIjoic3cuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBjdXJyZW50Q2FjaGUgPSAnbXdzLXN0YXRpYy12MSc7XG5jb25zdCBjdXJyZW50SW1nQ2FjaGUgPSAnbXdzLWltYWdlcy12MSc7XG5cbmNvbnN0IGN1cnJlbnRDYWNoZXMgPSBbY3VycmVudENhY2hlLCBjdXJyZW50SW1nQ2FjaGVdO1xuXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2ZldGNoJywgKGV2ZW50KSA9PiB7XG4gIGNvbnN0IHJlcXVlc3RVcmwgPSBuZXcgVVJMKGV2ZW50LnJlcXVlc3QudXJsKTtcbiAgY29uc3QgcmVxdWVzdENvcHkgPSBldmVudC5yZXF1ZXN0LmNsb25lKCk7XG5cbiAgLyogaGFuZGxlIEFQSSByZXF1ZXN0cyAqL1xuICBpZiAoWydQT1NUJywgJ1BVVCcsICdERUxFVEUnXVxuICAuaW5kZXhPZihldmVudC5yZXF1ZXN0Lm1ldGhvZC50b1VwcGVyQ2FzZSgpKSA+IC0xKSB7XG4gICAgZXZlbnQucmVzcG9uZFdpdGgoXG4gICAgICBmZXRjaChldmVudC5yZXF1ZXN0KS50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICByZXNwb25zZS5jbG9uZSgpLmpzb24oKS50aGVuKChyZXNwb25zZWRhdGEpID0+IHtcbiAgICAgICAgICBsZXQgaWQ7XG4gICAgICAgICAgbGV0IHRhcmdldDtcbiAgICAgICAgICBpZiAoJ3Jlc3RhdXJhbnRfaWQnIGluIHJlc3BvbnNlZGF0YSkge1xuICAgICAgICAgICAgLy8gaXQncyBhIHJldmlld1xuICAgICAgICAgICAgaWQgPSByZXNwb25zZWRhdGFbJ3Jlc3RhdXJhbnRfaWQnXTtcbiAgICAgICAgICAgIHRhcmdldCA9ICdyZXZpZXcnO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZCA9IHJlc3BvbnNlZGF0YVsnaWQnXTtcbiAgICAgICAgICAgIHRhcmdldCA9ICdyZXN0YXVyYW50JztcbiAgICAgICAgICB9XG4gICAgICAgICAgc2VuZENhY2hlTm90aWZpY2F0aW9uKHtcbiAgICAgICAgICAgICd0YXJnZXQnOiB0YXJnZXQsXG4gICAgICAgICAgICAnaWQnOiBpZFxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgc2VuZFJlcXVlc3ROb3RpZmljYXRpb24ocmVxdWVzdENvcHkpO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgIHJlamVjdCgnQVBJIHJlcXVlc3QgZmFpbGVkJywgZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgKTtcbiAgICByZXR1cm47XG4gIH1cblxuICAvKiBzb21lIG9iamVjdHMgYXJlIGNhY2hlZCBieSBkYmhlbHBlciBpbiBJbmRleGVkREIgKi9cbiAgaWYgKHJlcXVlc3RVcmwucGF0aG5hbWUubWF0Y2goJ15cXC8ocmVzdGF1cmFudHN8cmV2aWV3cyknKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChyZXF1ZXN0VXJsLnBhdGhuYW1lLm1hdGNoKC9cXC5qcGckL2kpKSB7XG4gICAgZXZlbnQucmVzcG9uZFdpdGgoc2VydmVQaG90byhldmVudC5yZXF1ZXN0KSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgZXZlbnQucmVzcG9uZFdpdGgoXG4gICAgY2FjaGVzLm1hdGNoKGV2ZW50LnJlcXVlc3QpLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICByZXR1cm4gcmVzcG9uc2UgfHwgZmV0Y2goZXZlbnQucmVxdWVzdCkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIHJldHVybiBjYWNoZXMub3BlbihjdXJyZW50Q2FjaGUpXG4gICAgICAgICAgICAgIC50aGVuKChjYWNoZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNhY2hlLnB1dChldmVudC5yZXF1ZXN0LCByZXNwb25zZS5jbG9uZSgpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcbiAgICAgICAgICAgICdUaGUgcmVxdWVzdGVkIHJlc291cmNlIGlzIGN1cnJlbnRseSBub3QgYXZhaWxhYmxlLCAnICtcbiAgICAgICAgICAgICdwbGVhc2UgdHJ5IGFnYWluIGxhdGVyJywge1xuICAgICAgICAgICAgICBzdGF0dXM6IDQwNCxcbiAgICAgICAgICAgICAgc3RhdHVzVGV4dDogZXJyb3IubWVzc2FnZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH0pXG4gICk7XG59KTtcblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgKGV2ZW50KSA9PiB7XG4gIGNvbnN0IGNhY2hlZFVybHMgPSBbXG4gICAgJy8nLFxuICAgICcvanMvbWFpbmJ1bmRsZS5qcycsXG4gICAgJy9qcy9kZXRhaWxzYnVuZGxlLmpzJyxcbiAgICAnL3Jlc3RhdXJhbnQuaHRtbCcsXG4gICAgJy9pbmRleC5odG1sJyxcbiAgICAnL2Nzcy9tYWluc3R5bGVzLmNzcycsXG4gICAgJy9jc3MvZGV0YWlsc3N0eWxlcy5jc3MnXG4gIF07XG4gIGV2ZW50LndhaXRVbnRpbChcbiAgICBjYWNoZXMub3BlbihjdXJyZW50Q2FjaGUpLnRoZW4oKGNhY2hlKSA9PiB7XG4gICAgICBjYWNoZS5hZGRBbGwoY2FjaGVkVXJscyk7XG4gICAgfSlcbiAgKTtcbn0pO1xuXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2FjdGl2YXRlJywgKGV2ZW50KSA9PiB7XG4gIGV2ZW50LndhaXRVbnRpbChcbiAgICBjYWNoZXMua2V5cygpLnRoZW4oKGNhY2hlTmFtZXMpID0+IHtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChcbiAgICAgICAgY2FjaGVOYW1lcy5maWx0ZXIoKGNhY2hlTmFtZSkgPT4ge1xuICAgICAgICAgIHJldHVybiBjYWNoZU5hbWUuc3RhcnRzV2l0aCgnbXdzLScpICYmXG4gICAgICAgICAgICBjdXJyZW50Q2FjaGVzLmluZGV4T2YoY2FjaGVOYW1lKSA9PT0gLTE7XG4gICAgICAgIH0pLm1hcCgoY2FjaGVOYW1lKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGNhY2hlcy5kZWxldGUoY2FjaGVOYW1lKTtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSlcbiAgKTtcbn0pO1xuXG5zZWxmLnNlcnZlUGhvdG8gPSAocmVxdWVzdCkgPT4ge1xuICBjb25zdCBzdG9yYWdlVXJsID0gcmVxdWVzdC51cmwucmVwbGFjZSgvXFxAXFxkK1xcLmpwZyQvLCAnJyk7XG5cbiAgcmV0dXJuIGNhY2hlcy5vcGVuKGN1cnJlbnRJbWdDYWNoZSkudGhlbigoY2FjaGUpID0+IHtcbiAgICByZXR1cm4gY2FjaGUubWF0Y2goc3RvcmFnZVVybCkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgIGlmIChyZXNwb25zZSkgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgcmV0dXJuIGZldGNoKHJlcXVlc3QpLnRoZW4oKG5ldHdvcmtSZXNwb25zZSkgPT4ge1xuICAgICAgICBjYWNoZS5wdXQoc3RvcmFnZVVybCwgbmV0d29ya1Jlc3BvbnNlLmNsb25lKCkpO1xuICAgICAgICByZXR1cm4gbmV0d29ya1Jlc3BvbnNlO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufTtcblxuc2VsZi5zZW5kQ2FjaGVOb3RpZmljYXRpb24gPSAoZGF0YSkgPT4ge1xuICBzZWxmLmNsaWVudHMubWF0Y2hBbGwoKS50aGVuKChjbGllbnRzKSA9PiB7XG4gICAgY2xpZW50cy5mb3JFYWNoKChjbGllbnQpID0+IHtcbiAgICAgIGNsaWVudC5wb3N0TWVzc2FnZSh7XG4gICAgICAgIG1lc3NhZ2U6ICdjYWNoZV9yZWZyZXNoJyxcbiAgICAgICAgY2FjaGVpbmZvOiBkYXRhXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59O1xuXG5zZWxmLnNlbmRSZXF1ZXN0Tm90aWZpY2F0aW9uID0gKHJlcXVlc3RDb3B5KSA9PiB7XG4gIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgcmVxdWVzdENvcHkuanNvbigpLnRoZW4oKGJvZHkpID0+IHtcbiAgICAgIHJlc29sdmUoe1xuICAgICAgICB1cmw6IHJlcXVlc3RDb3B5LnVybCxcbiAgICAgICAgbWV0aG9kOiByZXF1ZXN0Q29weS5tZXRob2QsXG4gICAgICAgIGJvZHk6IGJvZHlcbiAgICAgIH0pO1xuICAgIH0pXG4gICAgLmNhdGNoKCgpID0+IHtcbiAgICAgIHJlc29sdmUoe1xuICAgICAgICB1cmw6IHJlcXVlc3RDb3B5LnVybCxcbiAgICAgICAgbWV0aG9kOiByZXF1ZXN0Q29weS5tZXRob2RcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KVxuICAudGhlbigocmVxdWVzdERhdGEpID0+IHtcbiAgICBzZWxmLmNsaWVudHMubWF0Y2hBbGwoKS50aGVuKChjbGllbnRzKSA9PiB7XG4gICAgICBjbGllbnRzLmZvckVhY2goKGNsaWVudCkgPT4ge1xuICAgICAgICBjbGllbnQucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgIG1lc3NhZ2U6ICdyZXF1ZXN0X2ZhaWxlZCcsXG4gICAgICAgICAgcmVxdWVzdDogcmVxdWVzdERhdGFcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59O1xuIl19
