"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}var requestCache;!function(){function s(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function o(n,r,i){var o,e=new Promise(function(e,t){s(o=n[r].apply(n,i)).then(e,t)});return e.request=o,e}function e(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function t(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return o(this[n],e,arguments)})})}function n(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function r(e,r,t,n){n.forEach(function(n){n in t.prototype&&(e.prototype[n]=function(){return e=this[r],(t=o(e,n,arguments)).then(function(e){if(e)return new a(e,t.request)});var e,t})})}function i(e){this._index=e}function a(e,t){this._cursor=e,this._request=t}function c(e){this._store=e}function h(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function u(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new h(n)}function l(e){this._db=e}e(i,"_index",["name","keyPath","multiEntry","unique"]),t(i,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),r(i,"_index",IDBIndex,["openCursor","openKeyCursor"]),e(a,"_cursor",["direction","key","primaryKey","value"]),t(a,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(a.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),s(t._request).then(function(e){if(e)return new a(e,t._request)})})})}),c.prototype.createIndex=function(){return new i(this._store.createIndex.apply(this._store,arguments))},c.prototype.index=function(){return new i(this._store.index.apply(this._store,arguments))},e(c,"_store",["name","keyPath","indexNames","autoIncrement"]),t(c,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),r(c,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),n(c,"_store",IDBObjectStore,["deleteIndex"]),h.prototype.objectStore=function(){return new c(this._tx.objectStore.apply(this._tx,arguments))},e(h,"_tx",["objectStoreNames","mode"]),n(h,"_tx",IDBTransaction,["abort"]),u.prototype.createObjectStore=function(){return new c(this._db.createObjectStore.apply(this._db,arguments))},e(u,"_db",["name","version","objectStoreNames"]),n(u,"_db",IDBDatabase,["deleteObjectStore","close"]),l.prototype.transaction=function(){return new h(this._db.transaction.apply(this._db,arguments))},e(l,"_db",["name","version","objectStoreNames"]),n(l,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(o){[c,i].forEach(function(e){e.prototype[o.replace("open","iterate")]=function(){var e,t=(e=arguments,Array.prototype.slice.call(e)),n=t[t.length-1],r=this._store||this._index,i=r[o].apply(r,t.slice(0,-1));i.onsuccess=function(){n(i.result)}}})}),[i,c].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,i=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(i.push(e.value),void 0===n||i.length!=n?e.continue():t(i)):t(i)})})})});var d={open:function(e,t,n){var r=o(indexedDB,"open",[e,t]),i=r.request;return i.onupgradeneeded=function(e){n&&n(new u(i.result,e.oldVersion,i.transaction))},r.then(function(e){return new l(e)})},delete:function(e){return o(indexedDB,"deleteDatabase",[e])}};"undefined"!=typeof module?(module.exports=d,module.exports.default=module.exports):self.idb=d}();var retryInProgress=0;"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(function(e){_newArrowCheck(this,this),console.log("SW Registration successful. Scope is "+e.scope),requestCache=new ObjectCache("failedRequests",!0),navigator.serviceWorker.addEventListener("message",function(e){_newArrowCheck(this,this),"request_failed"===e.data.message&&(requestCache.put(e.data.request),showToaster("Some of your changes could not be saved","Retry",runRetryRequests),retryIfOnline())}.bind(this)),document.addEventListener("readystatechange",function(){_newArrowCheck(this,this),"complete"===document.readyState&&requestCache.getAll().then(function(e){_newArrowCheck(this,this),e.length&&showToaster("There are unsaved changes","Save",runRetryRequests)}.bind(this))}.bind(this))}.bind(void 0)).catch(function(e){_newArrowCheck(this,this),console.log("SW Registration failed with "+e)}.bind(void 0));var retryIfOnline=function(){_newArrowCheck(this,this),setTimeout(function(){_newArrowCheck(this,this),navigator.onLine?runRetryRequests():retryIfOnline()}.bind(this),2e3)}.bind(void 0),runRetryRequests=function(){_newArrowCheck(this,this),1===++retryInProgress&&(showToaster("Retrying requests, please wait...",null,null),retryRequests().then(function(e){_newArrowCheck(this,this),e?showToaster("Your changes were successfully stored. Reload the page to see the latest changes","Reload",function(){_newArrowCheck(this,this),window.location.reload()}.bind(this)):(showToaster("Some of your changes could not be saved","Retry",runRetryRequests),retryIfOnline()),retryInProgress=0}.bind(this)))}.bind(void 0),showToaster=function(e,t,n){_newArrowCheck(this,this);var r=document.querySelector("#toaster");if(null!==r){r.querySelector("#toaster-message").innerHTML=e;var i=r.querySelector("#toaster-button").querySelector("a");null!==t?(i.innerHTML=t,i.classList.remove("waiting")):(i.innerHTML="Ok",i.classList.add("waiting")),i.onclick=n,r.style.display="flex"}}.bind(void 0),hideToaster=function(){_newArrowCheck(this,this);var e=document.querySelector("#toaster");null!==e&&e.removeAttribute("style")}.bind(void 0),retryRequests=function(){_newArrowCheck(this,this);var n=[];return new Promise(function(t){_newArrowCheck(this,this),requestCache.takeAll().then(function(e){_newArrowCheck(this,this),e.forEach(function(e){_newArrowCheck(this,this);var t=fetch(e.url,{method:e.method,body:e.body?JSON.stringify(e.body):void 0});n.push(t)}.bind(this)),Promise.all(n).then(function(){return _newArrowCheck(this,this),t(!0)}.bind(this)).catch(function(){return _newArrowCheck(this,this),t(!1)}.bind(this))}.bind(this)).catch(function(){return _newArrowCheck(this,this),t(!1)}.bind(this))}.bind(this))}.bind(void 0),LazyLoader=function(){function t(e){if(_classCallCheck(this,t),"IntersectionObserver"in window){this.callback=e,this.observer=new IntersectionObserver(this.onIntersection.bind(this),{root:null,rootMargin:"0px",threshold:.01})}else this.observer=null}return _createClass(t,[{key:"isEnabled",value:function(){return null!==this.observer}},{key:"onIntersection",value:function(e){e.forEach(function(e){_newArrowCheck(this,this),e.isIntersecting&&!1!==this.callback(e.target)&&this.observer.unobserve(e.target)}.bind(this))}},{key:"observeEntry",value:function(e){this.observer.observe(e)}}],[{key:"loadPicture",value:function(e){e.querySelectorAll("source").forEach(function(e){_newArrowCheck(this,this),e.setAttribute("srcset",e.getAttribute("data-srcset"))}.bind(this));var t=e.querySelector("img");return t.setAttribute("src",t.getAttribute("data-src")),!0}}]),t}(),ObjectCache=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];_classCallCheck(this,n),this.cachename=e,this.openDb(t)}return _createClass(n,[{key:"openDb",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.cache=idb.open(this.cachename,1,function(e){switch(_newArrowCheck(this,this),e.oldVersion){case 0:e.createObjectStore("cache",{keyPath:"id",autoIncrement:t}).createIndex("by-id","id")}}.bind(this))}},{key:"getAll",value:function(){return this.cache.then(function(e){return _newArrowCheck(this,this),e.transaction("cache").objectStore("cache").index("by-id").getAll()}.bind(this))}},{key:"takeAll",value:function(){var r=[];return new Promise(function(n,t){_newArrowCheck(this,this),this.cache.then(function(e){_newArrowCheck(this,this);var t=e.transaction("cache","readwrite");t.objectStore("cache").index("by-id").iterateCursor(function(e){_newArrowCheck(this,this),e&&(r.push(e.value),e.delete(),e.continue())}.bind(this)),t.complete.then(function(){_newArrowCheck(this,this),n(r)}.bind(this))}.bind(this)).catch(function(e){_newArrowCheck(this,this),t(e)}.bind(this))}.bind(this))}},{key:"get",value:function(t){return this.cache.then(function(e){return _newArrowCheck(this,this),e.transaction("cache").objectStore("cache").get(t)}.bind(this))}},{key:"putAll",value:function(n){this.cache.then(function(e){_newArrowCheck(this,this);var t=e.transaction("cache","readwrite").objectStore("cache");n.forEach(function(e){_newArrowCheck(this,this),t.put(e)}.bind(this))}.bind(this))}},{key:"put",value:function(e){this.putAll([e])}},{key:"delete",value:function(t){this.cache.then(function(e){_newArrowCheck(this,this),e.transaction("cache","readwrite").objectStore("cache").delete(t)}.bind(this))}}]),n}();function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}var restaurantsCache=new ObjectCache("restaurants"),reviewsCache=new ObjectCache("reviews");"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",function(e){if(_newArrowCheck(this,this),"cache_refresh"===e.data.message){var t=e.data.cacheinfo;"restaurant"===t.target?(console.log("updating restaurant",t.id),DBHelper.fetchRestaurantById(t.id,function(){_newArrowCheck(this,this)}.bind(this))):(console.log("updating reviews",t.id),DBHelper.fetchReviews(t.id,function(){_newArrowCheck(this,this)}.bind(this)))}}.bind(void 0));var restaurants,neighborhoods,cuisines,map,DBHelper=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"getRestaurants",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:200;restaurantsCache.getAll().then(function(e){_newArrowCheck(this,this),e.length<10?setTimeout(this.getRestaurants(t,2*n),n):t(null,e)}.bind(this)).catch(function(){_newArrowCheck(this,this),this.fetchRestaurants(t)}.bind(this))}},{key:"fetchRestaurants",value:function(t){restaurantsCache.getAll().then(function(e){_newArrowCheck(this,this),10<=e.length&&(t(null,e),t=function(){_newArrowCheck(this,this)}.bind(this)),fetch(this.DATABASE_URL+"/restaurants").then(function(e){_newArrowCheck(this,this),e.json().then(function(e){_newArrowCheck(this,this),t(null,e),restaurantsCache.putAll(e)}.bind(this)).catch(function(e){return _newArrowCheck(this,this),t(e,null)}.bind(this))}.bind(this)).catch(function(e){return _newArrowCheck(this,this),t(e,null)}.bind(this))}.bind(this))}},{key:"fetchReviews",value:function(n,r){reviewsCache.getAll().then(function(e){if(_newArrowCheck(this,this),1<=e.length){var t=e.filter(function(e){return _newArrowCheck(this,this),e.restaurant_id==n}.bind(this));0<t.length&&(r(null,t),r=function(){_newArrowCheck(this,this)}.bind(this))}fetch(this.DATABASE_URL+"/reviews/?restaurant_id="+n).then(function(e){_newArrowCheck(this,this),e.json().then(function(e){_newArrowCheck(this,this),r(null,e),reviewsCache.putAll(e)}.bind(this)).catch(function(e){return _newArrowCheck(this,this),r(e,null)}.bind(this))}.bind(this)).catch(function(e){return _newArrowCheck(this,this),r(e,null)}.bind(this))}.bind(this))}},{key:"fetchRestaurantById",value:function(t,n){var r=!1;restaurantsCache.get(parseInt(t)).then(function(e){_newArrowCheck(this,this),"object"===_typeof(e)&&(r=!0,n(null,e)),r&&(n=function(){_newArrowCheck(this,this)}.bind(this)),fetch(this.DATABASE_URL+"/restaurants/"+t).then(function(e){_newArrowCheck(this,this),200===e.status?e.json().then(function(e){_newArrowCheck(this,this),n(null,e),restaurantsCache.put(e)}.bind(this)).catch(function(e){return _newArrowCheck(this,this),n(e,null)}.bind(this)):404===e.status?n("Restaurant does not exist",null):n(e.statusText,null)}.bind(this)).catch(function(e){return _newArrowCheck(this,this),n(e,null)}.bind(this))}.bind(this))}},{key:"fetchRestaurantByCuisine",value:function(r,i){n.fetchRestaurants(function(e,t){if(_newArrowCheck(this,this),e)i(e,null);else{var n=t.filter(function(e){return _newArrowCheck(this,this),e.cuisine_type==r}.bind(this));i(null,n)}}.bind(this))}},{key:"fetchRestaurantByNeighborhood",value:function(r,i){n.fetchRestaurants(function(e,t){if(_newArrowCheck(this,this),e)i(e,null);else{var n=t.filter(function(e){return _newArrowCheck(this,this),e.neighborhood==r}.bind(this));i(null,n)}}.bind(this))}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,i,o){n.fetchRestaurants(function(e,t){if(_newArrowCheck(this,this),e)o(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return _newArrowCheck(this,this),e.cuisine_type==r}.bind(this))),"all"!=i&&(n=n.filter(function(e){return _newArrowCheck(this,this),e.neighborhood==i}.bind(this))),o(null,n)}}.bind(this))}},{key:"fetchNeighborhoods",value:function(i){n.getRestaurants(function(e,n){if(_newArrowCheck(this,this),e)i(e,null);else{var r=n.map(function(e,t){return _newArrowCheck(this,this),n[t].neighborhood}.bind(this)),t=r.filter(function(e,t){return _newArrowCheck(this,this),r.indexOf(e)==t}.bind(this));i(null,t)}}.bind(this))}},{key:"fetchCuisines",value:function(i){n.getRestaurants(function(e,n){if(_newArrowCheck(this,this),e)i(e,null);else{var r=n.map(function(e,t){return _newArrowCheck(this,this),n[t].cuisine_type}.bind(this)),t=r.filter(function(e,t){return _newArrowCheck(this,this),r.indexOf(e)==t}.bind(this));i(null,t)}}.bind(this))}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id=".concat(e.id)}},{key:"imageUrlForRestaurant",value:function(e){return"/img/".concat(e.photograph)}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:n.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"toggleRestaurantFavorite",value:function(e,t){return fetch(n.DATABASE_URL+"/restaurants/".concat(e,"/?is_favorite=").concat(t),{method:"PUT"})}},{key:"addRestaurantReview",value:function(e){return fetch(n.DATABASE_URL+"/reviews/",{method:"POST",body:JSON.stringify(e)})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337"}}]),n}();function _newArrowCheck(e,t){if(e!==t)throw new TypeError("Cannot instantiate an arrow function")}var markers=[];document.onreadystatechange=function(){_newArrowCheck(this,this),"interactive"===document.readyState&&updateRestaurants()}.bind(void 0),document.addEventListener("DOMContentLoaded",function(){_newArrowCheck(this,this),fetchNeighborhoods(),fetchCuisines(),initializeMapToggle(),document.querySelectorAll("#neighborhoods-select,#cuisines-select").forEach(function(e){_newArrowCheck(this,this),e.addEventListener("change",updateRestaurants)}.bind(this))}.bind(void 0));var initializeMapToggle=function(){_newArrowCheck(this,this),document.querySelector("#toggle-map").addEventListener("click",function(e){_newArrowCheck(this,this),e.preventDefault();var t=document.querySelector("#map-container");if("false"===e.target.dataset.show){if(e.target.innerHTML="Hide results map",e.target.dataset.show="true",null===document.querySelector("#mapScript")){var n=document.createElement("script");n.id="mapScript",n.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCWYfWK4x2AWzzNW1B6YqeMg9JRmBRBygU&libraries=places&callback=initMap",document.querySelector("head").append(n)}0==self.markers.length&&addMarkersToMap()}else e.target.innerHTML="Show results on map",e.target.dataset.show="false";t.classList.toggle("hidden")}.bind(this))}.bind(void 0),fetchNeighborhoods=function(){_newArrowCheck(this,this),DBHelper.fetchNeighborhoods(function(e,t){_newArrowCheck(this,this),e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())}.bind(this))}.bind(void 0),fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods;_newArrowCheck(this,this);var n=document.getElementById("neighborhoods-select");e.forEach(function(e){_newArrowCheck(this,this);var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)}.bind(this))}.bind(void 0),fetchCuisines=function(){_newArrowCheck(this,this),DBHelper.fetchCuisines(function(e,t){_newArrowCheck(this,this),e?console.error(e):(self.cuisines=t,fillCuisinesHTML())}.bind(this))}.bind(void 0),fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines;_newArrowCheck(this,this);var n=document.getElementById("cuisines-select");e.forEach(function(e){_newArrowCheck(this,this);var t=document.createElement("option");t.innerHTML=e,t.value=e,n.append(t)}.bind(this))}.bind(void 0);window.initMap=function(){_newArrowCheck(this,this);self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),self.map.addListener("tilesloaded",setMapTitle),addMarkersToMap()}.bind(void 0);var setMapTitle=function(){_newArrowCheck(this,this),document.querySelector("#map").querySelector("iframe").setAttribute("title","Google maps with restaurant location")}.bind(void 0),updateRestaurants=function(){_newArrowCheck(this,this);var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,i=e[n].value,o=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(i,o,function(e,t){_newArrowCheck(this,this),e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())}.bind(this))}.bind(void 0),resetRestaurants=function(e){_newArrowCheck(this,this),self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(function(e){return _newArrowCheck(this,this),e.setMap(null)}.bind(this)),self.markers=[],self.restaurants=e}.bind(void 0),setupElementWithLabel=function(e,t,n){_newArrowCheck(this,this);var r=document.createElement("span");r.className="sr-only",r.innerHTML=t,e.append(r);var i=document.createTextNode(n);return e.append(i),e}.bind(void 0),fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants;_newArrowCheck(this,this);var n=document.getElementById("restaurants-list"),r=new LazyLoader(LazyLoader.loadPicture);e.forEach(function(e){_newArrowCheck(this,this);var t=createRestaurantHTML(e);r.isEnabled?r.observeEntry(t):LazyLoader.loadPicture(t),n.append(t)}.bind(this)),addMarkersToMap()}.bind(void 0),createPictureTag=function(e){_newArrowCheck(this,this);var r=DBHelper.imageUrlForRestaurant(e),i=document.createElement("picture");[{media:"(max-width: 400px)",srcset:["@400.jpg 1x",".jpg 2x"]},{media:"(max-width: 549px)",srcset:["@550.jpg 1x",".jpg 2x"]},{media:"(min-width: 550px)",srcset:["@400.jpg 1x",".jpg 2x"]}].forEach(function(e){_newArrowCheck(this,this);var t=document.createElement("data-source");t.setAttribute("media",e.media);var n=[];e.srcset.forEach(function(e){_newArrowCheck(this,this),n.push("".concat(r).concat(e))}.bind(this)),t.setAttribute("srcset",n.join(", ")),i.append(t)}.bind(this));var t=document.createElement("img");return t.setAttribute("data-src","".concat(r,"@550.jpg")),t.setAttribute("alt","Restaurant "+e.name),i.append(t),i}.bind(void 0),createRestaurantHTML=function(e){_newArrowCheck(this,this);var t=document.createElement("li");t.className="restaurant-container";var n=document.createElement("div");n.className="restaurant-img",n.append(createPictureTag(e)),t.append(n);var r=document.createElement("div");r.className="restaurant-summary";var i=document.createElement("h2");i.appendChild(createFavoriteToggle(e));var o=document.createTextNode(e.name);i.appendChild(o),r.append(i);var s=document.createElement("p");s.className="neighborhood pill",r.append(setupElementWithLabel(s,"Neighborhood:",e.neighborhood));var a=document.createElement("p");a.className="address",r.append(setupElementWithLabel(a,"Address:",e.address));var c=document.createElement("a");return c.innerHTML="View Details",c.href=DBHelper.urlForRestaurant(e),c.className="button",c.setAttribute("aria-label","View details of "+e.name),r.append(c),t.append(r),t}.bind(void 0),addMarkersToMap=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants;_newArrowCheck(this,this),"undefined"!=typeof google&&e.forEach(function(e){_newArrowCheck(this,this);var t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){_newArrowCheck(this,this),window.location.href=t.url}.bind(this)),self.markers.push(t)}.bind(this))}.bind(void 0),createFavoriteToggle=function(e){_newArrowCheck(this,this);var t=document.createElement("a");t.href="#",t.className="favorite-toggle",t.setAttribute("data-restaurant-id",e.id),t.setAttribute("role","switch");var n="true"===e.is_favorite?"true":"false";return t.setAttribute("aria-checked",n),t.setAttribute("title","Toggle favorite status of "+e.name),t.setAttribute("aria-label","Toggle favorite status of "+e.name),t.addEventListener("click",toggleFavoriteHandler),t}.bind(void 0),toggleFavoriteHandler=function(e){_newArrowCheck(this,this);var t=e.currentTarget,n=t.getAttribute("data-restaurant-id"),r="false"===t.getAttribute("aria-checked")?"true":"false";DBHelper.toggleRestaurantFavorite(n,r).then(function(){_newArrowCheck(this,this),t.setAttribute("aria-checked",r)}.bind(this)),e.preventDefault()}.bind(void 0);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlkYi5qcyIsImFwcC5qcyIsImRiaGVscGVyLmpzIiwibWFpbi5qcyJdLCJuYW1lcyI6WyJyZXF1ZXN0Q2FjaGUiLCJwcm9taXNpZnlSZXF1ZXN0IiwicmVxdWVzdCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0Iiwib25zdWNjZXNzIiwicmVzdWx0Iiwib25lcnJvciIsImVycm9yIiwicHJvbWlzaWZ5UmVxdWVzdENhbGwiLCJvYmoiLCJtZXRob2QiLCJhcmdzIiwicCIsImFwcGx5IiwidGhlbiIsInByb3h5UHJvcGVydGllcyIsIlByb3h5Q2xhc3MiLCJ0YXJnZXRQcm9wIiwicHJvcGVydGllcyIsImZvckVhY2giLCJwcm9wIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJwcm90b3R5cGUiLCJnZXQiLCJ0aGlzIiwic2V0IiwidmFsIiwicHJveHlSZXF1ZXN0TWV0aG9kcyIsIkNvbnN0cnVjdG9yIiwiYXJndW1lbnRzIiwicHJveHlNZXRob2RzIiwicHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyIsInZhbHVlIiwiQ3Vyc29yIiwiSW5kZXgiLCJpbmRleCIsIl9pbmRleCIsImN1cnNvciIsIl9jdXJzb3IiLCJfcmVxdWVzdCIsIk9iamVjdFN0b3JlIiwic3RvcmUiLCJfc3RvcmUiLCJUcmFuc2FjdGlvbiIsImlkYlRyYW5zYWN0aW9uIiwiX3R4IiwiY29tcGxldGUiLCJvbmNvbXBsZXRlIiwib25hYm9ydCIsIlVwZ3JhZGVEQiIsImRiIiwib2xkVmVyc2lvbiIsInRyYW5zYWN0aW9uIiwiX2RiIiwiREIiLCJJREJJbmRleCIsIklEQkN1cnNvciIsIm1ldGhvZE5hbWUiLCJjcmVhdGVJbmRleCIsIklEQk9iamVjdFN0b3JlIiwib2JqZWN0U3RvcmUiLCJJREJUcmFuc2FjdGlvbiIsImNyZWF0ZU9iamVjdFN0b3JlIiwiSURCRGF0YWJhc2UiLCJmdW5jTmFtZSIsInJlcGxhY2UiLCJhcnIiLCJBcnJheSIsInNsaWNlIiwiY2FsbCIsImNhbGxiYWNrIiwibGVuZ3RoIiwibmF0aXZlT2JqZWN0IiwiZ2V0QWxsIiwicXVlcnkiLCJjb3VudCIsImluc3RhbmNlIiwiaXRlbXMiLCJpdGVyYXRlQ3Vyc29yIiwicHVzaCIsInVuZGVmaW5lZCIsImNvbnRpbnVlIiwiZXhwIiwib3BlbiIsIm5hbWUiLCJ2ZXJzaW9uIiwidXBncmFkZUNhbGxiYWNrIiwiaW5kZXhlZERCIiwib251cGdyYWRlbmVlZGVkIiwiZXZlbnQiLCJkZWxldGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiZGVmYXVsdCIsInNlbGYiLCJpZGIiLCJyZXRyeUluUHJvZ3Jlc3MiLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwicmVnaXN0ZXIiLCJzY29wZSIsInJlZyIsIl9uZXdBcnJvd0NoZWNrIiwiY29uc29sZSIsImxvZyIsIk9iamVjdENhY2hlIiwiYWRkRXZlbnRMaXN0ZW5lciIsImRhdGEiLCJtZXNzYWdlIiwicHV0Iiwic2hvd1RvYXN0ZXIiLCJydW5SZXRyeVJlcXVlc3RzIiwicmV0cnlJZk9ubGluZSIsImJpbmQiLCJkb2N1bWVudCIsInJlYWR5U3RhdGUiLCJyZXF1ZXN0cyIsImNhdGNoIiwic2V0VGltZW91dCIsIm9uTGluZSIsInJldHJ5UmVxdWVzdHMiLCJzdWNjZXNzIiwid2luZG93IiwibG9jYXRpb24iLCJyZWxvYWQiLCJidG50ZXh0IiwidG9hc3RlciIsInF1ZXJ5U2VsZWN0b3IiLCJpbm5lckhUTUwiLCJidXR0b24iLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJvbmNsaWNrIiwic3R5bGUiLCJkaXNwbGF5IiwiaGlkZVRvYXN0ZXIiLCJyZW1vdmVBdHRyaWJ1dGUiLCJyZXRyaWVzIiwidGFrZUFsbCIsInIiLCJmZXRjaCIsInVybCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiYWxsIiwiTGF6eUxvYWRlciIsIl9jbGFzc0NhbGxDaGVjayIsIm9ic2VydmVyIiwiSW50ZXJzZWN0aW9uT2JzZXJ2ZXIiLCJvbkludGVyc2VjdGlvbiIsInJvb3QiLCJyb290TWFyZ2luIiwidGhyZXNob2xkIiwib2JzZXJ2ZWRFbnRyaWVzIiwiZW50cnkiLCJpc0ludGVyc2VjdGluZyIsInRhcmdldCIsInVub2JzZXJ2ZSIsIm9ic2VydmUiLCJxdWVyeVNlbGVjdG9yQWxsIiwic291cmNlIiwic2V0QXR0cmlidXRlIiwiZ2V0QXR0cmlidXRlIiwiaW1nIiwiY2FjaGVuYW1lIiwiYXV0b0luY3JlbWVudCIsIm9wZW5EYiIsImNhY2hlIiwidXBncmFkZURiIiwia2V5UGF0aCIsInR4IiwiaWQiLCJvYmplY3RzIiwib2JqZWN0IiwicHV0QWxsIiwicmVzdGF1cmFudHNDYWNoZSIsInJldmlld3NDYWNoZSIsImNhY2hlaW5mbyIsIkRCSGVscGVyIiwiZmV0Y2hSZXN0YXVyYW50QnlJZCIsImZldGNoUmV2aWV3cyIsInJlc3RhdXJhbnRzIiwibmVpZ2hib3Job29kcyIsImN1aXNpbmVzIiwibWFwIiwidGltZW91dCIsImdldFJlc3RhdXJhbnRzIiwiZmV0Y2hSZXN0YXVyYW50cyIsIkRBVEFCQVNFX1VSTCIsInJlc3BvbnNlIiwianNvbiIsInJlc3RhdXJhbnRJZCIsInJldmlld3MiLCJmaWx0ZXIiLCJlbCIsImdvdEZyb21DYWNoZSIsInBhcnNlSW50IiwiX3R5cGVvZiIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJjdWlzaW5lIiwicmVzdWx0cyIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsInYiLCJpIiwidW5pcXVlTmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJ1bmlxdWVDdWlzaW5lcyIsInJlc3RhdXJhbnQiLCJjb25jYXQiLCJwaG90b2dyYXBoIiwiZ29vZ2xlIiwibWFwcyIsIk1hcmtlciIsInBvc2l0aW9uIiwibGF0bG5nIiwidGl0bGUiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsImZhdm9yaXRlIiwicmV2aWV3IiwibWFya2VycyIsIm9ucmVhZHlzdGF0ZWNoYW5nZSIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiZmV0Y2hDdWlzaW5lcyIsImluaXRpYWxpemVNYXBUb2dnbGUiLCJwcmV2ZW50RGVmYXVsdCIsImRhdGFzZXQiLCJzaG93IiwiYWRkTXMiLCJjcmVhdGVFbGVtZW50Iiwic3JjIiwiYXBwZW5kIiwiYWRkTWFya2Vyc1RvTWFwIiwidG9nZ2xlIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwic2VsZWN0IiwiZ2V0RWxlbWVudEJ5SWQiLCJvcHRpb24iLCJmaWxsQ3Vpc2luZXNIVE1MIiwiaW5pdE1hcCIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJsYXQiLCJsbmciLCJzY3JvbGx3aGVlbCIsImFkZExpc3RlbmVyIiwic2V0TWFwVGl0bGUiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsIm0iLCJzZXRNYXAiLCJzZXR1cEVsZW1lbnRXaXRoTGFiZWwiLCJlbGVtZW50IiwibGFiZWwiLCJ0ZXh0IiwibGFiZWxFIiwiY2xhc3NOYW1lIiwidGV4dEUiLCJjcmVhdGVUZXh0Tm9kZSIsInVsIiwibGF6eSIsImxvYWRQaWN0dXJlIiwicmVzdEVudHJ5IiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJpc0VuYWJsZWQiLCJvYnNlcnZlRW50cnkiLCJjcmVhdGVQaWN0dXJlVGFnIiwiaW1nQmFzZSIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsInBpY3R1cmVUYWciLCJtZWRpYSIsInNyY3NldCIsInNvdXJjZVRhZyIsImpvaW4iLCJpbWdUYWciLCJsaSIsImltZ2RpdiIsInN1bW1hcnlkaXYiLCJhcHBlbmRDaGlsZCIsImNyZWF0ZUZhdm9yaXRlVG9nZ2xlIiwiYWRkcmVzcyIsIm1vcmUiLCJocmVmIiwibWFya2VyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImNoZWNrIiwiaXNfZmF2b3JpdGUiLCJ0b2dnbGVGYXZvcml0ZUhhbmRsZXIiLCJjdXJyZW50VGFyZ2V0IiwicklkIiwidG9nZ2xlUmVzdGF1cmFudEZhdm9yaXRlIl0sIm1hcHBpbmdzIjoiQUFBQSxxZkNBQSxJQUFJQSxjREVILFdBS0MsU0FBU0MsRUFBaUJDLEdBQ3hCLE9BQU8sSUFBSUMsUUFBUSxTQUFTQyxFQUFTQyxHQUNuQ0gsRUFBUUksVUFBWSxXQUNsQkYsRUFBUUYsRUFBUUssU0FHbEJMLEVBQVFNLFFBQVUsV0FDaEJILEVBQU9ILEVBQVFPLFVBS3JCLFNBQVNDLEVBQXFCQyxFQUFLQyxFQUFRQyxHQUN6QyxJQUFJWCxFQUNBWSxFQUFJLElBQUlYLFFBQVEsU0FBU0MsRUFBU0MsR0FFcENKLEVBREFDLEVBQVVTLEVBQUlDLEdBQVFHLE1BQU1KLEVBQUtFLElBQ1BHLEtBQUtaLEVBQVNDLEtBSTFDLE9BREFTLEVBQUVaLFFBQVVBLEVBQ0xZLEVBV1QsU0FBU0csRUFBZ0JDLEVBQVlDLEVBQVlDLEdBQy9DQSxFQUFXQyxRQUFRLFNBQVNDLEdBQzFCQyxPQUFPQyxlQUFlTixFQUFXTyxVQUFXSCxHQUMxQ0ksSUFBSyxXQUNILE9BQU9DLEtBQUtSLEdBQVlHLElBRTFCTSxJQUFLLFNBQVNDLEdBQ1pGLEtBQUtSLEdBQVlHLEdBQVFPLE9BTWpDLFNBQVNDLEVBQW9CWixFQUFZQyxFQUFZWSxFQUFhWCxHQUNoRUEsRUFBV0MsUUFBUSxTQUFTQyxHQUNwQkEsS0FBUVMsRUFBWU4sWUFDMUJQLEVBQVdPLFVBQVVILEdBQVEsV0FDM0IsT0FBT1osRUFBcUJpQixLQUFLUixHQUFhRyxFQUFNVSxlQUsxRCxTQUFTQyxFQUFhZixFQUFZQyxFQUFZWSxFQUFhWCxHQUN6REEsRUFBV0MsUUFBUSxTQUFTQyxHQUNwQkEsS0FBUVMsRUFBWU4sWUFDMUJQLEVBQVdPLFVBQVVILEdBQVEsV0FDM0IsT0FBT0ssS0FBS1IsR0FBWUcsR0FBTVAsTUFBTVksS0FBS1IsR0FBYWEsZUFLNUQsU0FBU0UsRUFBMEJoQixFQUFZQyxFQUFZWSxFQUFhWCxHQUN0RUEsRUFBV0MsUUFBUSxTQUFTQyxHQUNwQkEsS0FBUVMsRUFBWU4sWUFDMUJQLEVBQVdPLFVBQVVILEdBQVEsV0FDM0IsT0EzQzhCWCxFQTJDSWdCLEtBQUtSLElBMUN2Q0wsRUFBSUosRUFBcUJDLEVBMEMyQlcsRUFBTVUsWUF6Q3JEaEIsS0FBSyxTQUFTbUIsR0FDckIsR0FBS0EsRUFDTCxPQUFPLElBQUlDLEVBQU9ELEVBQU9yQixFQUFFWixXQUovQixJQUFvQ1MsRUFDOUJHLE1BK0NOLFNBQVN1QixFQUFNQyxHQUNiWCxLQUFLWSxPQUFTRCxFQXVCaEIsU0FBU0YsRUFBT0ksRUFBUXRDLEdBQ3RCeUIsS0FBS2MsUUFBVUQsRUFDZmIsS0FBS2UsU0FBV3hDLEVBK0JsQixTQUFTeUMsRUFBWUMsR0FDbkJqQixLQUFLa0IsT0FBU0QsRUF1Q2hCLFNBQVNFLEVBQVlDLEdBQ25CcEIsS0FBS3FCLElBQU1ELEVBQ1hwQixLQUFLc0IsU0FBVyxJQUFJOUMsUUFBUSxTQUFTQyxFQUFTQyxHQUM1QzBDLEVBQWVHLFdBQWEsV0FDMUI5QyxLQUVGMkMsRUFBZXZDLFFBQVUsV0FDdkJILEVBQU8wQyxFQUFldEMsUUFFeEJzQyxFQUFlSSxRQUFVLFdBQ3ZCOUMsRUFBTzBDLEVBQWV0QyxVQWtCNUIsU0FBUzJDLEVBQVVDLEVBQUlDLEVBQVlDLEdBQ2pDNUIsS0FBSzZCLElBQU1ILEVBQ1gxQixLQUFLMkIsV0FBYUEsRUFDbEIzQixLQUFLNEIsWUFBYyxJQUFJVCxFQUFZUyxHQWtCckMsU0FBU0UsRUFBR0osR0FDVjFCLEtBQUs2QixJQUFNSCxFQS9JYnBDLEVBQWdCb0IsRUFBTyxVQUNyQixPQUNBLFVBQ0EsYUFDQSxXQUdGUCxFQUFvQk8sRUFBTyxTQUFVcUIsVUFDbkMsTUFDQSxTQUNBLFNBQ0EsYUFDQSxVQUdGeEIsRUFBMEJHLEVBQU8sU0FBVXFCLFVBQ3pDLGFBQ0Esa0JBUUZ6QyxFQUFnQm1CLEVBQVEsV0FDdEIsWUFDQSxNQUNBLGFBQ0EsVUFHRk4sRUFBb0JNLEVBQVEsVUFBV3VCLFdBQ3JDLFNBQ0EsWUFJRCxVQUFXLFdBQVksc0JBQXNCdEMsUUFBUSxTQUFTdUMsR0FDdkRBLEtBQWNELFVBQVVsQyxZQUM5QlcsRUFBT1gsVUFBVW1DLEdBQWMsV0FDN0IsSUFBSXBCLEVBQVNiLEtBQ1RkLEVBQU9tQixVQUNYLE9BQU83QixRQUFRQyxVQUFVWSxLQUFLLFdBRTVCLE9BREF3QixFQUFPQyxRQUFRbUIsR0FBWTdDLE1BQU15QixFQUFPQyxRQUFTNUIsR0FDMUNaLEVBQWlCdUMsRUFBT0UsVUFBVTFCLEtBQUssU0FBU21CLEdBQ3JELEdBQUtBLEVBQ0wsT0FBTyxJQUFJQyxFQUFPRCxFQUFPSyxFQUFPRSxrQkFVeENDLEVBQVlsQixVQUFVb0MsWUFBYyxXQUNsQyxPQUFPLElBQUl4QixFQUFNVixLQUFLa0IsT0FBT2dCLFlBQVk5QyxNQUFNWSxLQUFLa0IsT0FBUWIsYUFHOURXLEVBQVlsQixVQUFVYSxNQUFRLFdBQzVCLE9BQU8sSUFBSUQsRUFBTVYsS0FBS2tCLE9BQU9QLE1BQU12QixNQUFNWSxLQUFLa0IsT0FBUWIsYUFHeERmLEVBQWdCMEIsRUFBYSxVQUMzQixPQUNBLFVBQ0EsYUFDQSxrQkFHRmIsRUFBb0JhLEVBQWEsU0FBVW1CLGdCQUN6QyxNQUNBLE1BQ0EsU0FDQSxRQUNBLE1BQ0EsU0FDQSxTQUNBLGFBQ0EsVUFHRjVCLEVBQTBCUyxFQUFhLFNBQVVtQixnQkFDL0MsYUFDQSxrQkFHRjdCLEVBQWFVLEVBQWEsU0FBVW1CLGdCQUNsQyxnQkFrQkZoQixFQUFZckIsVUFBVXNDLFlBQWMsV0FDbEMsT0FBTyxJQUFJcEIsRUFBWWhCLEtBQUtxQixJQUFJZSxZQUFZaEQsTUFBTVksS0FBS3FCLElBQUtoQixhQUc5RGYsRUFBZ0I2QixFQUFhLE9BQzNCLG1CQUNBLFNBR0ZiLEVBQWFhLEVBQWEsTUFBT2tCLGdCQUMvQixVQVNGWixFQUFVM0IsVUFBVXdDLGtCQUFvQixXQUN0QyxPQUFPLElBQUl0QixFQUFZaEIsS0FBSzZCLElBQUlTLGtCQUFrQmxELE1BQU1ZLEtBQUs2QixJQUFLeEIsYUFHcEVmLEVBQWdCbUMsRUFBVyxPQUN6QixPQUNBLFVBQ0EscUJBR0ZuQixFQUFhbUIsRUFBVyxNQUFPYyxhQUM3QixvQkFDQSxVQU9GVCxFQUFHaEMsVUFBVThCLFlBQWMsV0FDekIsT0FBTyxJQUFJVCxFQUFZbkIsS0FBSzZCLElBQUlELFlBQVl4QyxNQUFNWSxLQUFLNkIsSUFBS3hCLGFBRzlEZixFQUFnQndDLEVBQUksT0FDbEIsT0FDQSxVQUNBLHFCQUdGeEIsRUFBYXdCLEVBQUksTUFBT1MsYUFDdEIsV0FLRCxhQUFjLGlCQUFpQjdDLFFBQVEsU0FBUzhDLElBQzlDeEIsRUFBYU4sR0FBT2hCLFFBQVEsU0FBU1UsR0FDcENBLEVBQVlOLFVBQVUwQyxFQUFTQyxRQUFRLE9BQVEsWUFBYyxXQUMzRCxJQXBQV0MsRUFvUFB4RCxHQXBQT3dELEVBb1BRckMsVUFuUGhCc0MsTUFBTTdDLFVBQVU4QyxNQUFNQyxLQUFLSCxJQW9QMUJJLEVBQVc1RCxFQUFLQSxFQUFLNkQsT0FBUyxHQUM5QkMsRUFBZWhELEtBQUtrQixRQUFVbEIsS0FBS1ksT0FDbkNyQyxFQUFVeUUsRUFBYVIsR0FBVXBELE1BQU00RCxFQUFjOUQsRUFBSzBELE1BQU0sR0FBSSxJQUN4RXJFLEVBQVFJLFVBQVksV0FDbEJtRSxFQUFTdkUsRUFBUUssZUFPeEI4QixFQUFPTSxHQUFhdEIsUUFBUSxTQUFTVSxHQUNoQ0EsRUFBWU4sVUFBVW1ELFNBQzFCN0MsRUFBWU4sVUFBVW1ELE9BQVMsU0FBU0MsRUFBT0MsR0FDN0MsSUFBSUMsRUFBV3BELEtBQ1hxRCxLQUVKLE9BQU8sSUFBSTdFLFFBQVEsU0FBU0MsR0FDMUIyRSxFQUFTRSxjQUFjSixFQUFPLFNBQVNyQyxHQUNoQ0EsR0FJTHdDLEVBQU1FLEtBQUsxQyxFQUFPTCxZQUVKZ0QsSUFBVkwsR0FBdUJFLEVBQU1OLFFBQVVJLEVBSTNDdEMsRUFBTzRDLFdBSExoRixFQUFRNEUsSUFOUjVFLEVBQVE0RSxXQWVsQixJQUFJSyxHQUNGQyxLQUFNLFNBQVNDLEVBQU1DLEVBQVNDLEdBQzVCLElBQUkzRSxFQUFJSixFQUFxQmdGLFVBQVcsUUFBU0gsRUFBTUMsSUFDbkR0RixFQUFVWSxFQUFFWixRQVFoQixPQU5BQSxFQUFReUYsZ0JBQWtCLFNBQVNDLEdBQzdCSCxHQUNGQSxFQUFnQixJQUFJckMsRUFBVWxELEVBQVFLLE9BQVFxRixFQUFNdEMsV0FBWXBELEVBQVFxRCxlQUlyRXpDLEVBQUVFLEtBQUssU0FBU3FDLEdBQ3JCLE9BQU8sSUFBSUksRUFBR0osTUFHbEJ3QyxPQUFRLFNBQVNOLEdBQ2YsT0FBTzdFLEVBQXFCZ0YsVUFBVyxrQkFBbUJILE1BSXhDLG9CQUFYTyxRQUNUQSxPQUFPQyxRQUFVVixFQUNqQlMsT0FBT0MsUUFBUUMsUUFBVUYsT0FBT0MsU0FHaENFLEtBQUtDLElBQU1iLEVBbFRkLEdDREQsSUFBSWMsZ0JBQWtCLEVBRWxCLGtCQUFtQkMsV0FDbkJBLFVBQVVDLGNBQWNDLFNBQVMsVUFBWUMsTUFBTyxNQUNuRHZGLEtBQUssU0FBQ3dGLEdBQVFDLGVBQUE5RSxLQUFBQSxNQUNiK0UsUUFBUUMsSUFBSSx3Q0FBMENILEVBQUlELE9BQzFEdkcsYUFBZSxJQUFJNEcsWUFBWSxrQkFBa0IsR0FDakRSLFVBQVVDLGNBQWNRLGlCQUFpQixVQUFXLFNBQUNqQixHQUFVYSxlQUFBOUUsS0FBQUEsTUFDbEMsbUJBQXZCaUUsRUFBTWtCLEtBQUtDLFVBQ2IvRyxhQUFhZ0gsSUFBSXBCLEVBQU1rQixLQUFLNUcsU0FDNUIrRyxZQUFZLDBDQUNaLFFBQVNDLGtCQUNUQyxrQkFMSkMsS0FBQXpGLE9BUUEwRixTQUFTUixpQkFBaUIsbUJBQW9CLFdBQU1KLGVBQUE5RSxLQUFBQSxNQUN0QixhQUF4QjBGLFNBQVNDLFlBQ1h0SCxhQUFhNEUsU0FBUzVELEtBQUssU0FBQ3VHLEdBQWFkLGVBQUE5RSxLQUFBQSxNQUNuQzRGLEVBQVM3QyxRQUNYdUMsWUFBWSw0QkFDWixPQUFRQyxtQkFIWkUsS0FBQXpGLFFBRkp5RixLQUFBekYsUUFaRnlGLFVBQUEsSUFzQkdJLE1BQU0sU0FBQy9HLEdBQVVnRyxlQUFBOUUsS0FBQUEsTUFDbEIrRSxRQUFRQyxJQUFJLCtCQUFpQ2xHLElBdkIvQzJHLFVBQUEsSUE2QkosSUFBTUQsY0FBZ0IsV0FBTVYsZUFBQTlFLEtBQUFBLE1BQzFCOEYsV0FBVyxXQUFNaEIsZUFBQTlFLEtBQUFBLE1BQ1h5RSxVQUFVc0IsT0FDWlIsbUJBRUFDLGlCQUpKQyxLQUFBekYsTUFNRyxNQVBDeUYsVUFBQSxHQVVBRixpQkFBbUIsV0FBTVQsZUFBQTlFLEtBQUFBLE1BRUwsTUFEeEJ3RSxrQkFFQWMsWUFBWSxvQ0FBcUMsS0FBTSxNQUN2RFUsZ0JBQWdCM0csS0FBSyxTQUFDNEcsR0FBWW5CLGVBQUE5RSxLQUFBQSxNQUM1QmlHLEVBQ0ZYLFlBQVksbUZBQ2lDLFNBQVUsV0FBTVIsZUFBQTlFLEtBQUFBLE1BQzNEa0csT0FBT0MsU0FBU0MsVUFGbEJYLEtBQUF6RixRQUtBc0YsWUFBWSwwQ0FDWixRQUFTQyxrQkFDVEMsaUJBRUZoQixnQkFBa0IsR0FYcEJpQixLQUFBekYsU0FKSXlGLFVBQUEsR0FtQkFILFlBQWMsU0FBQ0YsRUFBU2lCLEVBQVN2RCxHQUFhZ0MsZUFBQTlFLEtBQUFBLE1BQ2xELElBQU1zRyxFQUFVWixTQUFTYSxjQUFjLFlBQ3ZDLEdBQUksT0FBU0QsRUFBUyxDQUNwQkEsRUFBUUMsY0FBYyxvQkFDbkJDLFVBQVlwQixFQUNmLElBQU1xQixFQUFTSCxFQUFRQyxjQUFjLG1CQUFtQkEsY0FBYyxLQUN0RCxPQUFaRixHQUNGSSxFQUFPRCxVQUFZSCxFQUNuQkksRUFBT0MsVUFBVUMsT0FBTyxhQUV4QkYsRUFBT0QsVUFBWSxLQUNuQkMsRUFBT0MsVUFBVUUsSUFBSSxZQUV2QkgsRUFBT0ksUUFBVS9ELEVBQ2pCd0QsRUFBUVEsTUFBTUMsUUFBVSxTQWR0QnRCLFVBQUEsR0FrQkF1QixZQUFjLFdBQU1sQyxlQUFBOUUsS0FBQUEsTUFDeEIsSUFBTXNHLEVBQVVaLFNBQVNhLGNBQWMsWUFDbkMsT0FBU0QsR0FDWEEsRUFBUVcsZ0JBQWdCLFVBSHRCeEIsVUFBQSxHQU9BTyxjQUFnQixXQUFNbEIsZUFBQTlFLEtBQUFBLE1BQzFCLElBQU1rSCxLQUNOLE9BQU8sSUFBSTFJLFFBQVEsU0FBQ0MsR0FBWXFHLGVBQUE5RSxLQUFBQSxNQUM5QjNCLGFBQWE4SSxVQUFVOUgsS0FBSyxTQUFDdUcsR0FBYWQsZUFBQTlFLEtBQUFBLE1BQ3hDNEYsRUFBU2xHLFFBQVEsU0FBQ25CLEdBQVl1RyxlQUFBOUUsS0FBQUEsTUFDNUIsSUFBTW9ILEVBQUlDLE1BQU05SSxFQUFRK0ksS0FDdEJySSxPQUFRVixFQUFRVSxPQUNoQnNJLEtBQU1oSixFQUFRZ0osS0FBT0MsS0FBS0MsVUFBVWxKLEVBQVFnSixXQUFRL0QsSUFFdEQwRCxFQUFRM0QsS0FBSzZELElBTGYzQixLQUFBekYsT0FPQXhCLFFBQVFrSixJQUFJUixHQUNYN0gsS0FBSyxXQUNKLE9BRFV5RixlQUFBOUUsS0FBQUEsTUFDSHZCLEdBQVEsSUFGakJnSCxLQUFBekYsT0FJQzZGLE1BQU0sV0FDTCxPQURXZixlQUFBOUUsS0FBQUEsTUFDSnZCLEdBQVEsSUFMakJnSCxLQUFBekYsUUFSRnlGLEtBQUF6RixPQWdCQzZGLE1BQU0sV0FDTCxPQURXZixlQUFBOUUsS0FBQUEsTUFDSnZCLEdBQVEsSUFqQmpCZ0gsS0FBQXpGLFFBREt5RixLQUFBekYsUUFGSHlGLFVBQUEsR0ErQkFrQyxzQkFDSixTQUFBQSxFQUFZN0UsR0FDVixHQURvQjhFLGdCQUFBNUgsS0FBQTJILEdBQ2YseUJBQTBCekIsT0FBUyxDQU10Q2xHLEtBQUs4QyxTQUFXQSxFQUNoQjlDLEtBQUs2SCxTQUFXLElBQUlDLHFCQUNsQjlILEtBQUsrSCxlQUFldEMsS0FBS3pGLE9BTnpCZ0ksS0FBTSxLQUNOQyxXQUFZLE1BQ1pDLFVBQVcsV0FRYmxJLEtBQUs2SCxTQUFXLDhEQUtsQixPQUF5QixPQUFsQjdILEtBQUs2SCxnREFHQ00sR0FDYkEsRUFBZ0J6SSxRQUFRLFNBQUMwSSxHQUFVdEQsZUFBQTlFLEtBQUFBLE1BQzdCb0ksRUFBTUMsaUJBQzRCLElBQWhDckksS0FBSzhDLFNBQVNzRixFQUFNRSxTQUN0QnRJLEtBQUs2SCxTQUFTVSxVQUFVSCxFQUFNRSxTQUhwQzdDLEtBQUF6Riw0Q0FTV29JLEdBQ1hwSSxLQUFLNkgsU0FBU1csUUFBUUoseUNBR0xBLEdBQ2pCQSxFQUFNSyxpQkFBaUIsVUFBVS9JLFFBQVEsU0FBQ2dKLEdBQVc1RCxlQUFBOUUsS0FBQUEsTUFDbkQwSSxFQUFPQyxhQUFhLFNBQVVELEVBQU9FLGFBQWEsaUJBRHBEbkQsS0FBQXpGLE9BR0EsSUFBTTZJLEVBQU1ULEVBQU03QixjQUFjLE9BRWhDLE9BREFzQyxFQUFJRixhQUFhLE1BQU9FLEVBQUlELGFBQWEsY0FDbEMsV0FPTDNELHVCQUNKLFNBQUFBLEVBQVk2RCxHQUFrQyxJQUF2QkMsRUFBdUIsRUFBQTFJLFVBQUEwQyxhQUFBUyxJQUFBbkQsVUFBQSxJQUFBQSxVQUFBLEdBQUF1SCxnQkFBQTVILEtBQUFpRixHQUM1Q2pGLEtBQUs4SSxVQUFZQSxFQUNqQjlJLEtBQUtnSixPQUFPRCx5REFHZ0IsSUFBdkJBLEVBQXVCLEVBQUExSSxVQUFBMEMsYUFBQVMsSUFBQW5ELFVBQUEsSUFBQUEsVUFBQSxHQUM1QkwsS0FBS2lKLE1BQVExRSxJQUFJWixLQUFLM0QsS0FBSzhJLFVBQVcsRUFBRyxTQUFDSSxHQUN4QyxPQURzRHBFLGVBQUE5RSxLQUFBQSxNQUM5Q2tKLEVBQVV2SCxZQUNoQixLQUFLLEVBQ1d1SCxFQUFVNUcsa0JBQWtCLFNBQ3hDNkcsUUFBUyxLQUNUSixjQUFlQSxJQUVYN0csWUFBWSxRQUFTLFFBUHBCdUQsS0FBQXpGLHdDQWFiLE9BQU9BLEtBQUtpSixNQUFNNUosS0FBSyxTQUFDcUMsR0FDdEIsT0FENkJvRCxlQUFBOUUsS0FBQUEsTUFDdEIwQixFQUFHRSxZQUFZLFNBQ25CUSxZQUFZLFNBQVN6QixNQUFNLFNBQzNCc0MsVUFIRXdDLEtBQUF6Rix5Q0FXUCxJQUFNcUQsS0FDTixPQUFPLElBQUk3RSxRQUFRLFNBQUNDLEVBQVNDLEdBQVdvRyxlQUFBOUUsS0FBQUEsTUFDdENBLEtBQUtpSixNQUFNNUosS0FBSyxTQUFDcUMsR0FBT29ELGVBQUE5RSxLQUFBQSxNQUN0QixJQUFNb0osRUFBSzFILEVBQUdFLFlBQVksUUFBUyxhQUNuQ3dILEVBQUdoSCxZQUFZLFNBQVN6QixNQUFNLFNBQVMyQyxjQUFjLFNBQUN6QyxHQUFXaUUsZUFBQTlFLEtBQUFBLE1BQzFEYSxJQUNMd0MsRUFBTUUsS0FBSzFDLEVBQU9MLE9BQ2xCSyxFQUFPcUQsU0FDUHJELEVBQU80QyxhQUpUZ0MsS0FBQXpGLE9BTUFvSixFQUFHOUgsU0FBU2pDLEtBQUssV0FBTXlGLGVBQUE5RSxLQUFBQSxNQUNyQnZCLEVBQVE0RSxJQURWb0MsS0FBQXpGLFFBUkZ5RixLQUFBekYsT0FZQzZGLE1BQU0sU0FBQy9HLEdBQVVnRyxlQUFBOUUsS0FBQUEsTUFDaEJ0QixFQUFPSSxJQWJUMkcsS0FBQXpGLFFBREt5RixLQUFBekYsbUNBbUJMcUosR0FDRixPQUFPckosS0FBS2lKLE1BQU01SixLQUFLLFNBQUNxQyxHQUN0QixPQUQ2Qm9ELGVBQUE5RSxLQUFBQSxNQUN0QjBCLEVBQUdFLFlBQVksU0FDbkJRLFlBQVksU0FBU3JDLElBQUlzSixJQUZ2QjVELEtBQUF6RixzQ0FNRnNKLEdBQ0x0SixLQUFLaUosTUFBTTVKLEtBQUssU0FBQ3FDLEdBQU9vRCxlQUFBOUUsS0FBQUEsTUFDdEIsSUFDTWlCLEVBREtTLEVBQUdFLFlBQVksUUFBUyxhQUNsQlEsWUFBWSxTQUM3QmtILEVBQVE1SixRQUFRLFNBQUM2SixHQUFXekUsZUFBQTlFLEtBQUFBLE1BQzFCaUIsRUFBTW9FLElBQUlrRSxJQURaOUQsS0FBQXpGLFFBSEZ5RixLQUFBekYsbUNBU0V1SixHQUNGdkosS0FBS3dKLFFBQVFELG1DQUdSRixHQUNMckosS0FBS2lKLE1BQU01SixLQUFLLFNBQUNxQyxHQUFPb0QsZUFBQTlFLEtBQUFBLE1BQ1gwQixFQUFHRSxZQUFZLFFBQVMsYUFDbEJRLFlBQVksU0FDdkI4QixPQUFPbUYsSUFIZjVELEtBQUF6Rix5dUJDN09KLElBQU15SixpQkFBbUIsSUFBSXhFLFlBQVksZUFDbkN5RSxhQUFlLElBQUl6RSxZQUFZLFdBRWpDLGtCQUFtQlIsV0FDckJBLFVBQVVDLGNBQWNRLGlCQUFpQixVQUFXLFNBQUNqQixHQUNuRCxHQUQ2RGEsZUFBQTlFLEtBQUFBLE1BQ2xDLGtCQUF2QmlFLEVBQU1rQixLQUFLQyxRQUE2QixDQUUxQyxJQUFNdUUsRUFBWTFGLEVBQU1rQixLQUFLd0UsVUFDSixlQUFyQkEsRUFBVXJCLFFBQ1p2RCxRQUFRQyxJQUFJLHNCQUF1QjJFLEVBQVVOLElBQzdDTyxTQUFTQyxvQkFBb0JGLEVBQVVOLEdBQUksV0FBTXZFLGVBQUE5RSxLQUFBQSxPQUFqRHlGLEtBQUF6RixTQUVBK0UsUUFBUUMsSUFBSSxtQkFBb0IyRSxFQUFVTixJQUMxQ08sU0FBU0UsYUFBYUgsRUFBVU4sR0FBSSxXQUFNdkUsZUFBQTlFLEtBQUFBLE9BQTFDeUYsS0FBQXpGLFVBVE55RixVQUFBLFFDUEVzRSxZQUNBQyxjQUNBQyxTQUNBQyxJRG1CRU4sMEhBYWtCOUcsR0FBeUIsSUFBZnFILEVBQWUsRUFBQTlKLFVBQUEwQyxhQUFBUyxJQUFBbkQsVUFBQSxHQUFBQSxVQUFBLEdBQUwsSUFDeENvSixpQkFBaUJ4RyxTQUFTNUQsS0FBSyxTQUFDaUssR0FBWXhFLGVBQUE5RSxLQUFBQSxNQUN0Q3NKLEVBQVF2RyxPQUFTLEdBQ25CK0MsV0FBVzlGLEtBQUtvSyxlQUFldEgsRUFBb0IsRUFBVnFILEdBQWNBLEdBRXZEckgsRUFBUyxLQUFNd0csSUFKbkI3RCxLQUFBekYsT0FPQzZGLE1BQU0sV0FBTWYsZUFBQTlFLEtBQUFBLE1BQ1hBLEtBQUtxSyxpQkFBaUJ2SCxJQVJ4QjJDLEtBQUF6RixnREFlc0I4QyxHQUN0QjJHLGlCQUFpQnhHLFNBQVM1RCxLQUFLLFNBQUNpSyxHQUFZeEUsZUFBQTlFLEtBQUFBLE1BQ3BCLElBQWxCc0osRUFBUXZHLFNBQ1ZELEVBQVMsS0FBTXdHLEdBQ2Z4RyxFQUFXLFdBQU1nQyxlQUFBOUUsS0FBQUEsT0FBakJ5RixLQUFBekYsT0FFRnFILE1BQU1ySCxLQUFLc0ssYUFBZSxnQkFBZ0JqTCxLQUFLLFNBQUNrTCxHQUFhekYsZUFBQTlFLEtBQUFBLE1BQzNEdUssRUFBU0MsT0FBT25MLEtBQUssU0FBQ21MLEdBQVMxRixlQUFBOUUsS0FBQUEsTUFDN0I4QyxFQUFTLEtBQU0wSCxHQUNmZixpQkFBaUJELE9BQU9nQixJQUYxQi9FLEtBQUF6RixPQUlDNkYsTUFBTSxTQUFDL0csR0FBRCxPQUFBZ0csZUFBQTlFLEtBQUFBLE1BQVc4QyxFQUFTaEUsRUFBTyxPQUpsQzJHLEtBQUF6RixRQURGeUYsS0FBQXpGLE9BT0M2RixNQUFNLFNBQUMvRyxHQUFELE9BQUFnRyxlQUFBOUUsS0FBQUEsTUFBVzhDLEVBQVNoRSxFQUFPLE9BUGxDMkcsS0FBQXpGLFFBTEZ5RixLQUFBekYsNENBbUJrQnlLLEVBQWMzSCxHQUNoQzRHLGFBQWF6RyxTQUFTNUQsS0FBSyxTQUFDaUssR0FDMUIsR0FEc0N4RSxlQUFBOUUsS0FBQUEsTUFDaEIsR0FBbEJzSixFQUFRdkcsT0FBYSxDQUN2QixJQUFNMkgsRUFBVXBCLEVBQVFxQixPQUN0QixTQUFDQyxHQUFELE9BQUE5RixlQUFBOUUsS0FBQUEsTUFBUTRLLEVBQUEsZUFBdUJILEdBRGpCaEYsS0FBQXpGLE9BR0ssRUFBakIwSyxFQUFRM0gsU0FDVkQsRUFBUyxLQUFNNEgsR0FDZjVILEVBQVcsV0FBTWdDLGVBQUE5RSxLQUFBQSxPQUFqQnlGLEtBQUF6RixPQUdKcUgsTUFBTXJILEtBQUtzSyxhQUFlLDJCQUE2QkcsR0FDdERwTCxLQUFLLFNBQUNrTCxHQUFhekYsZUFBQTlFLEtBQUFBLE1BQ2xCdUssRUFBU0MsT0FBT25MLEtBQUssU0FBQ21MLEdBQVMxRixlQUFBOUUsS0FBQUEsTUFDN0I4QyxFQUFTLEtBQU0wSCxHQUNmZCxhQUFhRixPQUFPZ0IsSUFGdEIvRSxLQUFBekYsT0FJQzZGLE1BQU0sU0FBQy9HLEdBQUQsT0FBQWdHLGVBQUE5RSxLQUFBQSxNQUFXOEMsRUFBU2hFLEVBQU8sT0FKbEMyRyxLQUFBekYsUUFGRnlGLEtBQUF6RixPQVFDNkYsTUFBTSxTQUFDL0csR0FBRCxPQUFBZ0csZUFBQTlFLEtBQUFBLE1BQVc4QyxFQUFTaEUsRUFBTyxPQVJsQzJHLEtBQUF6RixRQVZGeUYsS0FBQXpGLG1EQXlCeUJxSixFQUFJdkcsR0FDN0IsSUFBSStILEdBQWUsRUFDbkJwQixpQkFBaUIxSixJQUFJK0ssU0FBU3pCLElBQUtoSyxLQUFLLFNBQUNrSyxHQUFXekUsZUFBQTlFLEtBQUFBLE1BQzVCLFdBQWxCK0ssUUFBT3hCLEtBQ1RzQixHQUFlLEVBQ2YvSCxFQUFTLEtBQU15RyxJQUVic0IsSUFDRi9ILEVBQVcsV0FBTWdDLGVBQUE5RSxLQUFBQSxPQUFqQnlGLEtBQUF6RixPQUVGcUgsTUFBTXJILEtBQUtzSyxhQUFlLGdCQUFrQmpCLEdBQUloSyxLQUFLLFNBQUNrTCxHQUFhekYsZUFBQTlFLEtBQUFBLE1BQ3pDLE1BQXBCdUssRUFBU1MsT0FDWFQsRUFBU0MsT0FBT25MLEtBQUssU0FBQ21MLEdBQVMxRixlQUFBOUUsS0FBQUEsTUFDN0I4QyxFQUFTLEtBQU0wSCxHQUNmZixpQkFBaUJwRSxJQUFJbUYsSUFGdkIvRSxLQUFBekYsT0FJQzZGLE1BQU0sU0FBQy9HLEdBQUQsT0FBQWdHLGVBQUE5RSxLQUFBQSxNQUFXOEMsRUFBU2hFLEVBQU8sT0FKbEMyRyxLQUFBekYsT0FLNkIsTUFBcEJ1SyxFQUFTUyxPQUNsQmxJLEVBQVMsNEJBQTZCLE1BRXRDQSxFQUFTeUgsRUFBU1UsV0FBWSxPQVZsQ3hGLEtBQUF6RixPQWFDNkYsTUFBTSxTQUFDL0csR0FBRCxPQUFBZ0csZUFBQTlFLEtBQUFBLE1BQVc4QyxFQUFTaEUsRUFBTyxPQWJsQzJHLEtBQUF6RixRQVJGeUYsS0FBQXpGLHdEQTRCOEJrTCxFQUFTcEksR0FFdkM4RyxFQUFTUyxpQkFBaUIsU0FBQ3ZMLEVBQU9pTCxHQUNoQyxHQURnRGpGLGVBQUE5RSxLQUFBQSxNQUM1Q2xCLEVBQ0ZnRSxFQUFTaEUsRUFBTyxVQUNYLENBRUwsSUFBTXFNLEVBQVVwQixFQUFZWSxPQUFPLFNBQUN2RCxHQUFELE9BQUF0QyxlQUFBOUUsS0FBQUEsTUFBT29ILEVBQUVnRSxjQUFnQkYsR0FBNUN6RixLQUFBekYsT0FDaEI4QyxFQUFTLEtBQU1xSSxLQU5uQjFGLEtBQUF6Riw2REFjbUNxTCxFQUFjdkksR0FFakQ4RyxFQUFTUyxpQkFBaUIsU0FBQ3ZMLEVBQU9pTCxHQUNoQyxHQURnRGpGLGVBQUE5RSxLQUFBQSxNQUM1Q2xCLEVBQ0ZnRSxFQUFTaEUsRUFBTyxVQUNYLENBRUwsSUFBTXFNLEVBQVVwQixFQUFZWSxPQUMxQixTQUFDdkQsR0FBRCxPQUFBdEMsZUFBQTlFLEtBQUFBLE1BQU9vSCxFQUFFaUUsY0FBZ0JBLEdBRFg1RixLQUFBekYsT0FHaEI4QyxFQUFTLEtBQU1xSSxLQVJuQjFGLEtBQUF6Rix1RUFpQjZDa0wsRUFDN0NHLEVBQWN2SSxHQUVkOEcsRUFBU1MsaUJBQWlCLFNBQUN2TCxFQUFPaUwsR0FDaEMsR0FEZ0RqRixlQUFBOUUsS0FBQUEsTUFDNUNsQixFQUNGZ0UsRUFBU2hFLEVBQU8sVUFDWCxDQUNMLElBQUlxTSxFQUFVcEIsRUFDQyxPQUFYbUIsSUFDRkMsRUFBVUEsRUFBUVIsT0FBTyxTQUFDdkQsR0FBRCxPQUFBdEMsZUFBQTlFLEtBQUFBLE1BQU9vSCxFQUFFZ0UsY0FBZ0JGLEdBQXhDekYsS0FBQXpGLFFBRVEsT0FBaEJxTCxJQUNGRixFQUFVQSxFQUFRUixPQUFPLFNBQUN2RCxHQUFELE9BQUF0QyxlQUFBOUUsS0FBQUEsTUFBT29ILEVBQUVpRSxjQUFnQkEsR0FBeEM1RixLQUFBekYsUUFFWjhDLEVBQVMsS0FBTXFJLEtBWG5CMUYsS0FBQXpGLGtEQW1Cd0I4QyxHQUV4QjhHLEVBQVNRLGVBQWUsU0FBQ3RMLEVBQU9pTCxHQUM5QixHQUQ4Q2pGLGVBQUE5RSxLQUFBQSxNQUMxQ2xCLEVBQ0ZnRSxFQUFTaEUsRUFBTyxVQUNYLENBRUwsSUFBTWtMLEVBQWdCRCxFQUFZRyxJQUNoQyxTQUFDb0IsRUFBR0MsR0FBSixPQUFBekcsZUFBQTlFLEtBQUFBLE1BQVUrSixFQUFZd0IsR0FBR0YsY0FETDVGLEtBQUF6RixPQUloQndMLEVBQXNCeEIsRUFBY1csT0FDeEMsU0FBQ1csRUFBR0MsR0FBSixPQUFBekcsZUFBQTlFLEtBQUFBLE1BQVVnSyxFQUFjeUIsUUFBUUgsSUFBTUMsR0FEWjlGLEtBQUF6RixPQUc1QjhDLEVBQVMsS0FBTTBJLEtBWm5CL0YsS0FBQXpGLDZDQW9CbUI4QyxHQUVuQjhHLEVBQVNRLGVBQWUsU0FBQ3RMLEVBQU9pTCxHQUM5QixHQUQ4Q2pGLGVBQUE5RSxLQUFBQSxNQUMxQ2xCLEVBQ0ZnRSxFQUFTaEUsRUFBTyxVQUNYLENBRUwsSUFBTW1MLEVBQVdGLEVBQVlHLElBQUksU0FBQ29CLEVBQUdDLEdBQUosT0FBQXpHLGVBQUE5RSxLQUFBQSxNQUFVK0osRUFBWXdCLEdBQUdILGNBQXpDM0YsS0FBQXpGLE9BRVgwTCxFQUFpQnpCLEVBQVNVLE9BQzlCLFNBQUNXLEVBQUdDLEdBQUosT0FBQXpHLGVBQUE5RSxLQUFBQSxNQUFVaUssRUFBU3dCLFFBQVFILElBQU1DLEdBRFo5RixLQUFBekYsT0FHdkI4QyxFQUFTLEtBQU00SSxLQVZuQmpHLEtBQUF6RixnREFrQnNCMkwsR0FDdEIsTUFBQSx3QkFBQUMsT0FBZ0NELEVBQVd0QyxrREFNaEJzQyxHQUMzQixNQUFBLFFBQUFDLE9BQWdCRCxFQUFXRSwyREFNQ0YsRUFBWXpCLEdBUXhDLE9BUGUsSUFBSTRCLE9BQU9DLEtBQUtDLFFBQzdCQyxTQUFVTixFQUFXTyxPQUNyQkMsTUFBT1IsRUFBVy9ILEtBQ2xCMEQsSUFBS3NDLEVBQVN3QyxpQkFBaUJULEdBQy9CekIsSUFBS0EsRUFDTG1DLFVBQVdQLE9BQU9DLEtBQUtPLFVBQVVDLHdEQVFMbEQsRUFBSW1ELEdBQ2xDLE9BQU9uRixNQUFNdUMsRUFBU1UsYUFBVCxnQkFBQXNCLE9BQ0t2QyxFQURMLGtCQUFBdUMsT0FDd0JZLElBQ2pDdk4sT0FBUSxvREFPYXdOLEdBQ3pCLE9BQU9wRixNQUFNdUMsRUFBU1UsYUFBZSxhQUNuQ3JMLE9BQVEsT0FDUnNJLEtBQU1DLEtBQUtDLFVBQVVnRiwwQ0EvT3ZCLE1BQU8sbUlDeEJYLElBQUlDLFdBRUpoSCxTQUFTaUgsbUJBQXFCLFdBQU03SCxlQUFBOUUsS0FBQUEsTUFDTixnQkFBeEIwRixTQUFTQyxZQUNYaUgscUJBRkpuSCxVQUFBLEdBU0FDLFNBQVNSLGlCQUFpQixtQkFBb0IsV0FBTUosZUFBQTlFLEtBQUFBLE1BQ2xENk0scUJBQ0FDLGdCQUNBQyxzQkFDQXJILFNBQVMrQyxpQkFBaUIsMENBQTBDL0ksUUFDbEUsU0FBQ2tMLEdBQU85RixlQUFBOUUsS0FBQUEsTUFDTjRLLEVBQUcxRixpQkFBaUIsU0FBVTBILG9CQUZsQ25ILEtBQUF6RixRQUpGeUYsVUFBQSxJQWNBLElBQU1zSCxvQkFBc0IsV0FBTWpJLGVBQUE5RSxLQUFBQSxNQUNoQzBGLFNBQVNhLGNBQWMsZUFBZXJCLGlCQUFpQixRQUFTLFNBQUNqQixHQUFVYSxlQUFBOUUsS0FBQUEsTUFDekVpRSxFQUFNK0ksaUJBQ04sSUFBTTlDLEVBQU14RSxTQUFTYSxjQUFjLGtCQUNuQyxHQUFrQyxVQUE5QnRDLEVBQU1xRSxPQUFPMkUsUUFBUUMsS0FBa0IsQ0FJekMsR0FIQWpKLEVBQU1xRSxPQUFPOUIsVUFBWSxtQkFDekJ2QyxFQUFNcUUsT0FBTzJFLFFBQVFDLEtBQU8sT0FFeEIsT0FET3hILFNBQVNhLGNBQWMsY0FDakIsQ0FDZixJQUFNNEcsRUFBUXpILFNBQVMwSCxjQUFjLFVBQ3JDRCxFQUFNOUQsR0FBSyxZQUNYOEQsRUFBTUUsSUFBTSx3SEFDWjNILFNBQVNhLGNBQWMsUUFBUStHLE9BQU9ILEdBRWIsR0FBdkI3SSxLQUFLb0ksUUFBUTNKLFFBQ2Z3Syx1QkFHRnRKLEVBQU1xRSxPQUFPOUIsVUFBWSxzQkFDekJ2QyxFQUFNcUUsT0FBTzJFLFFBQVFDLEtBQU8sUUFFOUJoRCxFQUFJeEQsVUFBVThHLE9BQU8sV0FwQnZCL0gsS0FBQXpGLFFBREl5RixVQUFBLEdBNEJBb0gsbUJBQXFCLFdBQU0vSCxlQUFBOUUsS0FBQUEsTUFDL0I0SixTQUFTaUQsbUJBQW1CLFNBQUMvTixFQUFPa0wsR0FBa0JsRixlQUFBOUUsS0FBQUEsTUFDaERsQixFQUNGaUcsUUFBUWpHLE1BQU1BLElBRWR3RixLQUFLMEYsY0FBZ0JBLEVBQ3JCeUQsMEJBTEpoSSxLQUFBekYsUUFESXlGLFVBQUEsR0FjQWdJLHNCQUF3QixXQUF3QyxJQUF2Q3pELEVBQXVDLEVBQUEzSixVQUFBMEMsYUFBQVMsSUFBQW5ELFVBQUEsR0FBQUEsVUFBQSxHQUF2QmlFLEtBQUswRixjQUFrQmxGLGVBQUE5RSxLQUFBQSxNQUNwRSxJQUFNME4sRUFBU2hJLFNBQVNpSSxlQUFlLHdCQUN2QzNELEVBQWN0SyxRQUFRLFNBQUMyTCxHQUFpQnZHLGVBQUE5RSxLQUFBQSxNQUN0QyxJQUFNNE4sRUFBU2xJLFNBQVMwSCxjQUFjLFVBQ3RDUSxFQUFPcEgsVUFBWTZFLEVBQ25CdUMsRUFBT3BOLE1BQVE2SyxFQUNmcUMsRUFBT0osT0FBT00sSUFKaEJuSSxLQUFBekYsUUFGSXlGLFVBQUEsR0FhQXFILGNBQWdCLFdBQU1oSSxlQUFBOUUsS0FBQUEsTUFDMUI0SixTQUFTa0QsY0FBYyxTQUFDaE8sRUFBT21MLEdBQWFuRixlQUFBOUUsS0FBQUEsTUFDdENsQixFQUNGaUcsUUFBUWpHLE1BQU1BLElBRWR3RixLQUFLMkYsU0FBV0EsRUFDaEI0RCxxQkFMSnBJLEtBQUF6RixRQURJeUYsVUFBQSxHQWNBb0ksaUJBQW1CLFdBQThCLElBQTdCNUQsRUFBNkIsRUFBQTVKLFVBQUEwQyxhQUFBUyxJQUFBbkQsVUFBQSxHQUFBQSxVQUFBLEdBQWxCaUUsS0FBSzJGLFNBQWFuRixlQUFBOUUsS0FBQUEsTUFDckQsSUFBTTBOLEVBQVNoSSxTQUFTaUksZUFBZSxtQkFFdkMxRCxFQUFTdkssUUFBUSxTQUFDd0wsR0FBWXBHLGVBQUE5RSxLQUFBQSxNQUM1QixJQUFNNE4sRUFBU2xJLFNBQVMwSCxjQUFjLFVBQ3RDUSxFQUFPcEgsVUFBWTBFLEVBQ25CMEMsRUFBT3BOLE1BQVEwSyxFQUNmd0MsRUFBT0osT0FBT00sSUFKaEJuSSxLQUFBekYsUUFISXlGLFVBQUEsR0FjTlMsT0FBTzRILFFBQVUsV0FBTWhKLGVBQUE5RSxLQUFBQSxNQUtyQnNFLEtBQUs0RixJQUFNLElBQUk0QixPQUFPQyxLQUFLZ0MsSUFBSXJJLFNBQVNpSSxlQUFlLFFBQ3JESyxLQUFNLEdBQ05DLFFBTEFDLElBQUssVUFDTEMsS0FBTSxXQUtOQyxhQUFhLElBRWY5SixLQUFLNEYsSUFBSW1FLFlBQVksY0FBZUMsYUFDcENmLG1CQVhGOUgsVUFBQSxHQWlCQSxJQUFNNkksWUFBYyxXQUFNeEosZUFBQTlFLEtBQUFBLE1BQ1AwRixTQUFTYSxjQUFjLFFBQVFBLGNBQWMsVUFDckRvQyxhQUFhLFFBQVMseUNBRjNCbEQsVUFBQSxHQVFBbUgsa0JBQW9CLFdBQU05SCxlQUFBOUUsS0FBQUEsTUFDOUIsSUFBTXVPLEVBQVU3SSxTQUFTaUksZUFBZSxtQkFDbENhLEVBQVU5SSxTQUFTaUksZUFBZSx3QkFFbENjLEVBQVNGLEVBQVFHLGNBQ2pCQyxFQUFTSCxFQUFRRSxjQUVqQnhELEVBQVVxRCxFQUFRRSxHQUFRak8sTUFDMUI2SyxFQUFlbUQsRUFBUUcsR0FBUW5PLE1BRXJDb0osU0FBU2dGLHdDQUF3QzFELEVBQVNHLEVBQ3hELFNBQUN2TSxFQUFPaUwsR0FBZ0JqRixlQUFBOUUsS0FBQUEsTUFDcEJsQixFQUNGaUcsUUFBUWpHLE1BQU1BLElBRWQrUCxpQkFBaUI5RSxHQUNqQitFLHdCQU5KckosS0FBQXpGLFFBVkl5RixVQUFBLEdBd0JBb0osaUJBQW1CLFNBQUM5RSxHQUFnQmpGLGVBQUE5RSxLQUFBQSxNQUV4Q3NFLEtBQUt5RixlQUNNckUsU0FBU2lJLGVBQWUsb0JBQ2hDbkgsVUFBWSxHQUdmbEMsS0FBS29JLFFBQVFoTixRQUFRLFNBQUNxUCxHQUFELE9BQUFqSyxlQUFBOUUsS0FBQUEsTUFBTytPLEVBQUVDLE9BQU8sT0FBckN2SixLQUFBekYsT0FDQXNFLEtBQUtvSSxXQUNMcEksS0FBS3lGLFlBQWNBLEdBVGZ0RSxVQUFBLEdBZUF3SixzQkFBd0IsU0FBQ0MsRUFBU0MsRUFBT0MsR0FBU3RLLGVBQUE5RSxLQUFBQSxNQUN0RCxJQUFNcVAsRUFBUzNKLFNBQVMwSCxjQUFjLFFBQ3RDaUMsRUFBT0MsVUFBWSxVQUNuQkQsRUFBTzdJLFVBQVkySSxFQUNuQkQsRUFBUTVCLE9BQU8rQixHQUNmLElBQU1FLEVBQVE3SixTQUFTOEosZUFBZUosR0FFdEMsT0FEQUYsRUFBUTVCLE9BQU9pQyxHQUNSTCxHQVBIekosVUFBQSxHQWFBcUosb0JBQXNCLFdBQW9DLElBQW5DL0UsRUFBbUMsRUFBQTFKLFVBQUEwQyxhQUFBUyxJQUFBbkQsVUFBQSxHQUFBQSxVQUFBLEdBQXJCaUUsS0FBS3lGLFlBQWdCakYsZUFBQTlFLEtBQUFBLE1BQzlELElBQU15UCxFQUFLL0osU0FBU2lJLGVBQWUsb0JBQzdCK0IsRUFBTyxJQUFJL0gsV0FBV0EsV0FBV2dJLGFBQ3ZDNUYsRUFBWXJLLFFBQVEsU0FBQ2lNLEdBQWU3RyxlQUFBOUUsS0FBQUEsTUFDbEMsSUFBTTRQLEVBQVlDLHFCQUFxQmxFLEdBQ25DK0QsRUFBS0ksVUFDUEosRUFBS0ssYUFBYUgsR0FFbEJqSSxXQUFXZ0ksWUFBWUMsR0FFekJILEVBQUduQyxPQUFPc0MsSUFQWm5LLEtBQUF6RixPQVNBdU4sbUJBWkk5SCxVQUFBLEdBa0JBdUssaUJBQW1CLFNBQUNyRSxHQUFlN0csZUFBQTlFLEtBQUFBLE1BQ3ZDLElBQU1pUSxFQUFVckcsU0FBU3NHLHNCQUFzQnZFLEdBQ3pDd0UsRUFBYXpLLFNBQVMwSCxjQUFjLGFBR3RDZ0QsTUFBTyxxQkFDUEMsUUFBUyxjQUFlLGFBR3hCRCxNQUFPLHFCQUNQQyxRQUFTLGNBQWUsYUFHeEJELE1BQU8scUJBQ1BDLFFBQVMsY0FBZSxhQUdkM1EsUUFBUSxTQUFDTyxHQUFRNkUsZUFBQTlFLEtBQUFBLE1BQzdCLElBQU1zUSxFQUFZNUssU0FBUzBILGNBQWMsZUFDekNrRCxFQUFVM0gsYUFBYSxRQUFTMUksRUFBSW1RLE9BQ3BDLElBQU1DLEtBQ05wUSxFQUFJb1EsT0FBTzNRLFFBQVEsU0FBQ21KLEdBQVEvRCxlQUFBOUUsS0FBQUEsTUFDMUJxUSxFQUFPOU0sS0FBUCxHQUFBcUksT0FBZXFFLEdBQWZyRSxPQUF5Qi9DLEtBRDNCcEQsS0FBQXpGLE9BR0FzUSxFQUFVM0gsYUFBYSxTQUFVMEgsRUFBT0UsS0FBSyxPQUM3Q0osRUFBVzdDLE9BQU9nRCxJQVJwQjdLLEtBQUF6RixPQVVBLElBQU13USxFQUFTOUssU0FBUzBILGNBQWMsT0FJdEMsT0FIQW9ELEVBQU83SCxhQUFhLFdBQXBCLEdBQUFpRCxPQUFtQ3FFLEVBQW5DLGFBQ0FPLEVBQU83SCxhQUFhLE1BQU8sY0FBZ0JnRCxFQUFXL0gsTUFDdER1TSxFQUFXN0MsT0FBT2tELEdBQ1hMLEdBL0JIMUssVUFBQSxHQXFDQW9LLHFCQUF1QixTQUFDbEUsR0FBZTdHLGVBQUE5RSxLQUFBQSxNQUMzQyxJQUFNeVEsRUFBSy9LLFNBQVMwSCxjQUFjLE1BQ2xDcUQsRUFBR25CLFVBQVksdUJBRWYsSUFBTW9CLEVBQVNoTCxTQUFTMEgsY0FBYyxPQUN0Q3NELEVBQU9wQixVQUFZLGlCQUNuQm9CLEVBQU9wRCxPQUFPMEMsaUJBQWlCckUsSUFDL0I4RSxFQUFHbkQsT0FBT29ELEdBRVYsSUFBTUMsRUFBYWpMLFNBQVMwSCxjQUFjLE9BQzFDdUQsRUFBV3JCLFVBQVkscUJBRXZCLElBQU1uRCxFQUFRekcsU0FBUzBILGNBQWMsTUFDckNqQixFQUFNeUUsWUFBWUMscUJBQXFCbEYsSUFDdkMsSUFBTS9ILEVBQU84QixTQUFTOEosZUFBZTdELEVBQVcvSCxNQUNoRHVJLEVBQU15RSxZQUFZaE4sR0FDbEIrTSxFQUFXckQsT0FBT25CLEdBRWxCLElBQU1kLEVBQWUzRixTQUFTMEgsY0FBYyxLQUM1Qy9CLEVBQWFpRSxVQUFZLG9CQUN6QnFCLEVBQVdyRCxPQUNUMkIsc0JBQXNCNUQsRUFDcEIsZ0JBQ0FNLEVBQVdOLGVBSWYsSUFBTXlGLEVBQVVwTCxTQUFTMEgsY0FBYyxLQUN2QzBELEVBQVF4QixVQUFZLFVBQ3BCcUIsRUFBV3JELE9BQ1QyQixzQkFBc0I2QixFQUFTLFdBQVluRixFQUFXbUYsVUFHeEQsSUFBTUMsRUFBT3JMLFNBQVMwSCxjQUFjLEtBU3BDLE9BUkEyRCxFQUFLdkssVUFBWSxlQUNqQnVLLEVBQUtDLEtBQU9wSCxTQUFTd0MsaUJBQWlCVCxHQUN0Q29GLEVBQUt6QixVQUFZLFNBQ2pCeUIsRUFBS3BJLGFBQWEsYUFBYyxtQkFBcUJnRCxFQUFXL0gsTUFDaEUrTSxFQUFXckQsT0FBT3lELEdBRWxCTixFQUFHbkQsT0FBT3FELEdBRUhGLEdBMUNIaEwsVUFBQSxHQWdEQThILGdCQUFrQixXQUFvQyxJQUFuQ3hELEVBQW1DLEVBQUExSixVQUFBMEMsYUFBQVMsSUFBQW5ELFVBQUEsR0FBQUEsVUFBQSxHQUFyQmlFLEtBQUt5RixZQUFnQmpGLGVBQUE5RSxLQUFBQSxNQUNwQyxvQkFBWDhMLFFBR1gvQixFQUFZckssUUFBUSxTQUFDaU0sR0FBZTdHLGVBQUE5RSxLQUFBQSxNQUVsQyxJQUFNaVIsRUFBU3JILFNBQVNzSCx1QkFBdUJ2RixFQUFZckgsS0FBSzRGLEtBQ2hFNEIsT0FBT0MsS0FBSzlILE1BQU1vSyxZQUFZNEMsRUFBUSxRQUFTLFdBQU1uTSxlQUFBOUUsS0FBQUEsTUFDbkRrRyxPQUFPQyxTQUFTNkssS0FBT0MsRUFBTzNKLEtBRGhDN0IsS0FBQXpGLE9BR0FzRSxLQUFLb0ksUUFBUW5KLEtBQUswTixJQU5wQnhMLEtBQUF6RixRQUpJeUYsVUFBQSxHQWNBb0wscUJBQXVCLFNBQUNsRixHQUFlN0csZUFBQTlFLEtBQUFBLE1BQzNDLElBQU15RyxFQUFTZixTQUFTMEgsY0FBYyxLQUN0QzNHLEVBQU91SyxLQUFLLElBQ1p2SyxFQUFPNkksVUFBWSxrQkFDbkI3SSxFQUFPa0MsYUFBYSxxQkFBc0JnRCxFQUFXdEMsSUFDckQ1QyxFQUFPa0MsYUFBYSxPQUFRLFVBQzVCLElBQU13SSxFQUFtQyxTQUEzQnhGLEVBQVd5RixZQUF5QixPQUFTLFFBTzNELE9BTkEzSyxFQUFPa0MsYUFBYSxlQUFnQndJLEdBQ3BDMUssRUFBT2tDLGFBQWEsUUFBUyw2QkFDN0JnRCxFQUFXL0gsTUFDWDZDLEVBQU9rQyxhQUFhLGFBQWMsNkJBQ2xDZ0QsRUFBVy9ILE1BQ1g2QyxFQUFPdkIsaUJBQWlCLFFBQVNtTSx1QkFDMUI1SyxHQWJIaEIsVUFBQSxHQWdCQTRMLHNCQUF3QixTQUFDcE4sR0FBVWEsZUFBQTlFLEtBQUFBLE1BQ3ZDLElBQU1zSSxFQUFTckUsRUFBTXFOLGNBQ2ZDLEVBQU1qSixFQUFPTSxhQUFhLHNCQUMxQnVJLEVBQWdELFVBQXhDN0ksRUFBT00sYUFBYSxnQkFDaEMsT0FBUyxRQUNYZ0IsU0FBUzRILHlCQUF5QkQsRUFBS0osR0FDdEM5UixLQUFLLFdBQU15RixlQUFBOUUsS0FBQUEsTUFDVnNJLEVBQU9LLGFBQWEsZUFBZ0J3SSxJQUZ0QzFMLEtBQUF6RixPQUlBaUUsRUFBTStJLGtCQVRGdkgsVUFBQSIsImZpbGUiOiJtYWluYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG4oZnVuY3Rpb24oKSB7XG4gIGZ1bmN0aW9uIHRvQXJyYXkoYXJyKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFycik7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzdWx0KTtcbiAgICAgIH07XG5cbiAgICAgIHJlcXVlc3Qub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZWplY3QocmVxdWVzdC5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpIHtcbiAgICB2YXIgcmVxdWVzdDtcbiAgICB2YXIgcCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgcmVxdWVzdCA9IG9ialttZXRob2RdLmFwcGx5KG9iaiwgYXJncyk7XG4gICAgICBwcm9taXNpZnlSZXF1ZXN0KHJlcXVlc3QpLnRoZW4ocmVzb2x2ZSwgcmVqZWN0KTtcbiAgICB9KTtcblxuICAgIHAucmVxdWVzdCA9IHJlcXVlc3Q7XG4gICAgcmV0dXJuIHA7XG4gIH1cblxuICBmdW5jdGlvbiBwcm9taXNpZnlDdXJzb3JSZXF1ZXN0Q2FsbChvYmosIG1ldGhvZCwgYXJncykge1xuICAgIHZhciBwID0gcHJvbWlzaWZ5UmVxdWVzdENhbGwob2JqLCBtZXRob2QsIGFyZ3MpO1xuICAgIHJldHVybiBwLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgIHJldHVybiBuZXcgQ3Vyc29yKHZhbHVlLCBwLnJlcXVlc3QpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlQcm9wZXJ0aWVzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIHByb3BlcnRpZXMpIHtcbiAgICBwcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFByb3h5Q2xhc3MucHJvdG90eXBlLCBwcm9wLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF07XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgdGhpc1t0YXJnZXRQcm9wXVtwcm9wXSA9IHZhbDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eVJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeVJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJveHlNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXNbdGFyZ2V0UHJvcF1bcHJvcF0uYXBwbHkodGhpc1t0YXJnZXRQcm9wXSwgYXJndW1lbnRzKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBwcm94eUN1cnNvclJlcXVlc3RNZXRob2RzKFByb3h5Q2xhc3MsIHRhcmdldFByb3AsIENvbnN0cnVjdG9yLCBwcm9wZXJ0aWVzKSB7XG4gICAgcHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIGlmICghKHByb3AgaW4gQ29uc3RydWN0b3IucHJvdG90eXBlKSkgcmV0dXJuO1xuICAgICAgUHJveHlDbGFzcy5wcm90b3R5cGVbcHJvcF0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHByb21pc2lmeUN1cnNvclJlcXVlc3RDYWxsKHRoaXNbdGFyZ2V0UHJvcF0sIHByb3AsIGFyZ3VtZW50cyk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gSW5kZXgoaW5kZXgpIHtcbiAgICB0aGlzLl9pbmRleCA9IGluZGV4O1xuICB9XG5cbiAgcHJveHlQcm9wZXJ0aWVzKEluZGV4LCAnX2luZGV4JywgW1xuICAgICduYW1lJyxcbiAgICAna2V5UGF0aCcsXG4gICAgJ211bHRpRW50cnknLFxuICAgICd1bmlxdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdnZXQnLFxuICAgICdnZXRLZXknLFxuICAgICdnZXRBbGwnLFxuICAgICdnZXRBbGxLZXlzJyxcbiAgICAnY291bnQnXG4gIF0pO1xuXG4gIHByb3h5Q3Vyc29yUmVxdWVzdE1ldGhvZHMoSW5kZXgsICdfaW5kZXgnLCBJREJJbmRleCwgW1xuICAgICdvcGVuQ3Vyc29yJyxcbiAgICAnb3BlbktleUN1cnNvcidcbiAgXSk7XG5cbiAgZnVuY3Rpb24gQ3Vyc29yKGN1cnNvciwgcmVxdWVzdCkge1xuICAgIHRoaXMuX2N1cnNvciA9IGN1cnNvcjtcbiAgICB0aGlzLl9yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgfVxuXG4gIHByb3h5UHJvcGVydGllcyhDdXJzb3IsICdfY3Vyc29yJywgW1xuICAgICdkaXJlY3Rpb24nLFxuICAgICdrZXknLFxuICAgICdwcmltYXJ5S2V5JyxcbiAgICAndmFsdWUnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoQ3Vyc29yLCAnX2N1cnNvcicsIElEQkN1cnNvciwgW1xuICAgICd1cGRhdGUnLFxuICAgICdkZWxldGUnXG4gIF0pO1xuXG4gIC8vIHByb3h5ICduZXh0JyBtZXRob2RzXG4gIFsnYWR2YW5jZScsICdjb250aW51ZScsICdjb250aW51ZVByaW1hcnlLZXknXS5mb3JFYWNoKGZ1bmN0aW9uKG1ldGhvZE5hbWUpIHtcbiAgICBpZiAoIShtZXRob2ROYW1lIGluIElEQkN1cnNvci5wcm90b3R5cGUpKSByZXR1cm47XG4gICAgQ3Vyc29yLnByb3RvdHlwZVttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGN1cnNvciA9IHRoaXM7XG4gICAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICBjdXJzb3IuX2N1cnNvclttZXRob2ROYW1lXS5hcHBseShjdXJzb3IuX2N1cnNvciwgYXJncyk7XG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KGN1cnNvci5fcmVxdWVzdCkudGhlbihmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgIGlmICghdmFsdWUpIHJldHVybjtcbiAgICAgICAgICByZXR1cm4gbmV3IEN1cnNvcih2YWx1ZSwgY3Vyc29yLl9yZXF1ZXN0KTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICBmdW5jdGlvbiBPYmplY3RTdG9yZShzdG9yZSkge1xuICAgIHRoaXMuX3N0b3JlID0gc3RvcmU7XG4gIH1cblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuY3JlYXRlSW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmNyZWF0ZUluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBPYmplY3RTdG9yZS5wcm90b3R5cGUuaW5kZXggPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IEluZGV4KHRoaXMuX3N0b3JlLmluZGV4LmFwcGx5KHRoaXMuX3N0b3JlLCBhcmd1bWVudHMpKTtcbiAgfTtcblxuICBwcm94eVByb3BlcnRpZXMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBbXG4gICAgJ25hbWUnLFxuICAgICdrZXlQYXRoJyxcbiAgICAnaW5kZXhOYW1lcycsXG4gICAgJ2F1dG9JbmNyZW1lbnQnXG4gIF0pO1xuXG4gIHByb3h5UmVxdWVzdE1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdwdXQnLFxuICAgICdhZGQnLFxuICAgICdkZWxldGUnLFxuICAgICdjbGVhcicsXG4gICAgJ2dldCcsXG4gICAgJ2dldEFsbCcsXG4gICAgJ2dldEtleScsXG4gICAgJ2dldEFsbEtleXMnLFxuICAgICdjb3VudCdcbiAgXSk7XG5cbiAgcHJveHlDdXJzb3JSZXF1ZXN0TWV0aG9kcyhPYmplY3RTdG9yZSwgJ19zdG9yZScsIElEQk9iamVjdFN0b3JlLCBbXG4gICAgJ29wZW5DdXJzb3InLFxuICAgICdvcGVuS2V5Q3Vyc29yJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoT2JqZWN0U3RvcmUsICdfc3RvcmUnLCBJREJPYmplY3RTdG9yZSwgW1xuICAgICdkZWxldGVJbmRleCdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gVHJhbnNhY3Rpb24oaWRiVHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl90eCA9IGlkYlRyYW5zYWN0aW9uO1xuICAgIHRoaXMuY29tcGxldGUgPSBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcbiAgICAgIGlkYlRyYW5zYWN0aW9uLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVqZWN0KGlkYlRyYW5zYWN0aW9uLmVycm9yKTtcbiAgICAgIH07XG4gICAgICBpZGJUcmFuc2FjdGlvbi5vbmFib3J0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlamVjdChpZGJUcmFuc2FjdGlvbi5lcnJvcik7XG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgVHJhbnNhY3Rpb24ucHJvdG90eXBlLm9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl90eC5vYmplY3RTdG9yZS5hcHBseSh0aGlzLl90eCwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFRyYW5zYWN0aW9uLCAnX3R4JywgW1xuICAgICdvYmplY3RTdG9yZU5hbWVzJyxcbiAgICAnbW9kZSdcbiAgXSk7XG5cbiAgcHJveHlNZXRob2RzKFRyYW5zYWN0aW9uLCAnX3R4JywgSURCVHJhbnNhY3Rpb24sIFtcbiAgICAnYWJvcnQnXG4gIF0pO1xuXG4gIGZ1bmN0aW9uIFVwZ3JhZGVEQihkYiwgb2xkVmVyc2lvbiwgdHJhbnNhY3Rpb24pIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICAgIHRoaXMub2xkVmVyc2lvbiA9IG9sZFZlcnNpb247XG4gICAgdGhpcy50cmFuc2FjdGlvbiA9IG5ldyBUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG4gIH1cblxuICBVcGdyYWRlREIucHJvdG90eXBlLmNyZWF0ZU9iamVjdFN0b3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBPYmplY3RTdG9yZSh0aGlzLl9kYi5jcmVhdGVPYmplY3RTdG9yZS5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKFVwZ3JhZGVEQiwgJ19kYicsIFtcbiAgICAnbmFtZScsXG4gICAgJ3ZlcnNpb24nLFxuICAgICdvYmplY3RTdG9yZU5hbWVzJ1xuICBdKTtcblxuICBwcm94eU1ldGhvZHMoVXBncmFkZURCLCAnX2RiJywgSURCRGF0YWJhc2UsIFtcbiAgICAnZGVsZXRlT2JqZWN0U3RvcmUnLFxuICAgICdjbG9zZSdcbiAgXSk7XG5cbiAgZnVuY3Rpb24gREIoZGIpIHtcbiAgICB0aGlzLl9kYiA9IGRiO1xuICB9XG5cbiAgREIucHJvdG90eXBlLnRyYW5zYWN0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBUcmFuc2FjdGlvbih0aGlzLl9kYi50cmFuc2FjdGlvbi5hcHBseSh0aGlzLl9kYiwgYXJndW1lbnRzKSk7XG4gIH07XG5cbiAgcHJveHlQcm9wZXJ0aWVzKERCLCAnX2RiJywgW1xuICAgICduYW1lJyxcbiAgICAndmVyc2lvbicsXG4gICAgJ29iamVjdFN0b3JlTmFtZXMnXG4gIF0pO1xuXG4gIHByb3h5TWV0aG9kcyhEQiwgJ19kYicsIElEQkRhdGFiYXNlLCBbXG4gICAgJ2Nsb3NlJ1xuICBdKTtcblxuICAvLyBBZGQgY3Vyc29yIGl0ZXJhdG9yc1xuICAvLyBUT0RPOiByZW1vdmUgdGhpcyBvbmNlIGJyb3dzZXJzIGRvIHRoZSByaWdodCB0aGluZyB3aXRoIHByb21pc2VzXG4gIFsnb3BlbkN1cnNvcicsICdvcGVuS2V5Q3Vyc29yJ10uZm9yRWFjaChmdW5jdGlvbihmdW5jTmFtZSkge1xuICAgIFtPYmplY3RTdG9yZSwgSW5kZXhdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZVtmdW5jTmFtZS5yZXBsYWNlKCdvcGVuJywgJ2l0ZXJhdGUnKV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSB0b0FycmF5KGFyZ3VtZW50cyk7XG4gICAgICAgIHZhciBjYWxsYmFjayA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcbiAgICAgICAgdmFyIG5hdGl2ZU9iamVjdCA9IHRoaXMuX3N0b3JlIHx8IHRoaXMuX2luZGV4O1xuICAgICAgICB2YXIgcmVxdWVzdCA9IG5hdGl2ZU9iamVjdFtmdW5jTmFtZV0uYXBwbHkobmF0aXZlT2JqZWN0LCBhcmdzLnNsaWNlKDAsIC0xKSk7XG4gICAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgY2FsbGJhY2socmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICB9O1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gcG9seWZpbGwgZ2V0QWxsXG4gIFtJbmRleCwgT2JqZWN0U3RvcmVdLmZvckVhY2goZnVuY3Rpb24oQ29uc3RydWN0b3IpIHtcbiAgICBpZiAoQ29uc3RydWN0b3IucHJvdG90eXBlLmdldEFsbCkgcmV0dXJuO1xuICAgIENvbnN0cnVjdG9yLnByb3RvdHlwZS5nZXRBbGwgPSBmdW5jdGlvbihxdWVyeSwgY291bnQpIHtcbiAgICAgIHZhciBpbnN0YW5jZSA9IHRoaXM7XG4gICAgICB2YXIgaXRlbXMgPSBbXTtcblxuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcbiAgICAgICAgaW5zdGFuY2UuaXRlcmF0ZUN1cnNvcihxdWVyeSwgZnVuY3Rpb24oY3Vyc29yKSB7XG4gICAgICAgICAgaWYgKCFjdXJzb3IpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpdGVtcy5wdXNoKGN1cnNvci52YWx1ZSk7XG5cbiAgICAgICAgICBpZiAoY291bnQgIT09IHVuZGVmaW5lZCAmJiBpdGVtcy5sZW5ndGggPT0gY291bnQpIHtcbiAgICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9O1xuICB9KTtcblxuICB2YXIgZXhwID0ge1xuICAgIG9wZW46IGZ1bmN0aW9uKG5hbWUsIHZlcnNpb24sIHVwZ3JhZGVDYWxsYmFjaykge1xuICAgICAgdmFyIHAgPSBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdvcGVuJywgW25hbWUsIHZlcnNpb25dKTtcbiAgICAgIHZhciByZXF1ZXN0ID0gcC5yZXF1ZXN0O1xuXG4gICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmICh1cGdyYWRlQ2FsbGJhY2spIHtcbiAgICAgICAgICB1cGdyYWRlQ2FsbGJhY2sobmV3IFVwZ3JhZGVEQihyZXF1ZXN0LnJlc3VsdCwgZXZlbnQub2xkVmVyc2lvbiwgcmVxdWVzdC50cmFuc2FjdGlvbikpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gcC50aGVuKGZ1bmN0aW9uKGRiKSB7XG4gICAgICAgIHJldHVybiBuZXcgREIoZGIpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0Q2FsbChpbmRleGVkREIsICdkZWxldGVEYXRhYmFzZScsIFtuYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZXhwO1xuICAgIG1vZHVsZS5leHBvcnRzLmRlZmF1bHQgPSBtb2R1bGUuZXhwb3J0cztcbiAgfVxuICBlbHNlIHtcbiAgICBzZWxmLmlkYiA9IGV4cDtcbiAgfVxufSgpKTtcbiIsImxldCByZXF1ZXN0Q2FjaGU7XG5sZXQgcmV0cnlJblByb2dyZXNzID0gMDtcblxuaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3N3LmpzJywgeyBzY29wZTogJy8nIH0pXG4gICAgLnRoZW4oKHJlZykgPT4ge1xuICAgICAgY29uc29sZS5sb2coJ1NXIFJlZ2lzdHJhdGlvbiBzdWNjZXNzZnVsLiBTY29wZSBpcyAnICsgcmVnLnNjb3BlKTtcbiAgICAgIHJlcXVlc3RDYWNoZSA9IG5ldyBPYmplY3RDYWNoZSgnZmFpbGVkUmVxdWVzdHMnLCB0cnVlKTtcbiAgICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgaWYgKGV2ZW50LmRhdGEubWVzc2FnZSA9PT0gJ3JlcXVlc3RfZmFpbGVkJykge1xuICAgICAgICAgIHJlcXVlc3RDYWNoZS5wdXQoZXZlbnQuZGF0YS5yZXF1ZXN0KTtcbiAgICAgICAgICBzaG93VG9hc3RlcignU29tZSBvZiB5b3VyIGNoYW5nZXMgY291bGQgbm90IGJlIHNhdmVkJyxcbiAgICAgICAgICAnUmV0cnknLCBydW5SZXRyeVJlcXVlc3RzKTtcbiAgICAgICAgICByZXRyeUlmT25saW5lKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncmVhZHlzdGF0ZWNoYW5nZScsICgpID0+IHtcbiAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHtcbiAgICAgICAgICByZXF1ZXN0Q2FjaGUuZ2V0QWxsKCkudGhlbigocmVxdWVzdHMpID0+IHtcbiAgICAgICAgICAgIGlmIChyZXF1ZXN0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgc2hvd1RvYXN0ZXIoJ1RoZXJlIGFyZSB1bnNhdmVkIGNoYW5nZXMnLFxuICAgICAgICAgICAgICAnU2F2ZScsIHJ1blJldHJ5UmVxdWVzdHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KS5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKCdTVyBSZWdpc3RyYXRpb24gZmFpbGVkIHdpdGggJyArIGVycm9yKTtcbiAgICB9KTtcbn1cblxuLy8gZG9jdW1lbnQub25vbmxpbmUgZG9lc24ndCBzZWVtIHRvIGJlIHJlbGlhYmxlLFxuLy8gbmF2aWdhdG9yLm9uTGluZSBsb29rcyBsaWtlIGEgYmV0dGVyIHNvdXJjZVxuY29uc3QgcmV0cnlJZk9ubGluZSA9ICgpID0+IHtcbiAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgaWYgKG5hdmlnYXRvci5vbkxpbmUpIHtcbiAgICAgIHJ1blJldHJ5UmVxdWVzdHMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0cnlJZk9ubGluZSgpO1xuICAgIH1cbiAgfSwgMjAwMCk7XG59O1xuXG5jb25zdCBydW5SZXRyeVJlcXVlc3RzID0gKCkgPT4ge1xuICByZXRyeUluUHJvZ3Jlc3MrKztcbiAgaWYgKHJldHJ5SW5Qcm9ncmVzcyAhPT0gMSkgcmV0dXJuO1xuICBzaG93VG9hc3RlcignUmV0cnlpbmcgcmVxdWVzdHMsIHBsZWFzZSB3YWl0Li4uJywgbnVsbCwgbnVsbCk7XG4gIHJldHJ5UmVxdWVzdHMoKS50aGVuKChzdWNjZXNzKSA9PiB7XG4gICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgIHNob3dUb2FzdGVyKCdZb3VyIGNoYW5nZXMgd2VyZSBzdWNjZXNzZnVsbHkgc3RvcmVkLiAnICtcbiAgICAgICdSZWxvYWQgdGhlIHBhZ2UgdG8gc2VlIHRoZSBsYXRlc3QgY2hhbmdlcycsICdSZWxvYWQnLCAoKSA9PiB7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBzaG93VG9hc3RlcignU29tZSBvZiB5b3VyIGNoYW5nZXMgY291bGQgbm90IGJlIHNhdmVkJyxcbiAgICAgICdSZXRyeScsIHJ1blJldHJ5UmVxdWVzdHMpO1xuICAgICAgcmV0cnlJZk9ubGluZSgpO1xuICAgIH1cbiAgICByZXRyeUluUHJvZ3Jlc3MgPSAwO1xuICB9KTtcbn07XG5cbmNvbnN0IHNob3dUb2FzdGVyID0gKG1lc3NhZ2UsIGJ0bnRleHQsIGNhbGxiYWNrKSA9PiB7XG4gIGNvbnN0IHRvYXN0ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG9hc3RlcicpO1xuICBpZiAobnVsbCAhPT0gdG9hc3Rlcikge1xuICAgIHRvYXN0ZXIucXVlcnlTZWxlY3RvcignI3RvYXN0ZXItbWVzc2FnZScpXG4gICAgICAuaW5uZXJIVE1MID0gbWVzc2FnZTtcbiAgICBjb25zdCBidXR0b24gPSB0b2FzdGVyLnF1ZXJ5U2VsZWN0b3IoJyN0b2FzdGVyLWJ1dHRvbicpLnF1ZXJ5U2VsZWN0b3IoJ2EnKTtcbiAgICBpZiAoYnRudGV4dCAhPT0gbnVsbCkge1xuICAgICAgYnV0dG9uLmlubmVySFRNTCA9IGJ0bnRleHQ7XG4gICAgICBidXR0b24uY2xhc3NMaXN0LnJlbW92ZSgnd2FpdGluZycpO1xuICAgIH0gZWxzZSB7XG4gICAgICBidXR0b24uaW5uZXJIVE1MID0gJ09rJztcbiAgICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKCd3YWl0aW5nJyk7XG4gICAgfVxuICAgIGJ1dHRvbi5vbmNsaWNrID0gY2FsbGJhY2s7XG4gICAgdG9hc3Rlci5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnO1xuICB9XG59O1xuXG5jb25zdCBoaWRlVG9hc3RlciA9ICgpID0+IHtcbiAgY29uc3QgdG9hc3RlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0b2FzdGVyJyk7XG4gIGlmIChudWxsICE9PSB0b2FzdGVyKSB7XG4gICAgdG9hc3Rlci5yZW1vdmVBdHRyaWJ1dGUoJ3N0eWxlJyk7XG4gIH1cbn07XG5cbmNvbnN0IHJldHJ5UmVxdWVzdHMgPSAoKSA9PiB7XG4gIGNvbnN0IHJldHJpZXMgPSBbXTtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgcmVxdWVzdENhY2hlLnRha2VBbGwoKS50aGVuKChyZXF1ZXN0cykgPT4ge1xuICAgICAgcmVxdWVzdHMuZm9yRWFjaCgocmVxdWVzdCkgPT4ge1xuICAgICAgICBjb25zdCByID0gZmV0Y2gocmVxdWVzdC51cmwsIHtcbiAgICAgICAgICBtZXRob2Q6IHJlcXVlc3QubWV0aG9kLFxuICAgICAgICAgIGJvZHk6IHJlcXVlc3QuYm9keSA/IEpTT04uc3RyaW5naWZ5KHJlcXVlc3QuYm9keSkgOiB1bmRlZmluZWRcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHJpZXMucHVzaChyKTtcbiAgICAgIH0pO1xuICAgICAgUHJvbWlzZS5hbGwocmV0cmllcylcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlc29sdmUodHJ1ZSk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKCgpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlc29sdmUoZmFsc2UpO1xuICAgICAgfSk7XG4gICAgfSlcbiAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgcmV0dXJuIHJlc29sdmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbi8qKiBcbiAqIExhenlMb2FkZXIgLSBsYXp5IGxvYWQgZW50cmllcyB1c2luZyBjYWxsYmFja1xuICogQGNvbnN0cnVjdG9yXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSBjYWxsYmFjazogZnVuY3Rpb24gdG8gaGFuZGxlIGxvYWRpbmcgb24gaW50ZXJzZWN0XG4gKiAgRWxlbWVudCBpcyB1bm9ic2VydmVkIHVubGVzcyB0aGUgY2FsbGJhY2sgcmV0dXJucyBmYWxzZVxuKi9cbmNsYXNzIExhenlMb2FkZXIge1xuICBjb25zdHJ1Y3RvcihjYWxsYmFjaykge1xuICAgIGlmICgoJ0ludGVyc2VjdGlvbk9ic2VydmVyJyBpbiB3aW5kb3cpKSB7XG4gICAgICBjb25zdCBpb0NvbmZpZyA9IHtcbiAgICAgICAgcm9vdDogbnVsbCxcbiAgICAgICAgcm9vdE1hcmdpbjogJzBweCcsXG4gICAgICAgIHRocmVzaG9sZDogMC4wMVxuICAgICAgfTtcbiAgICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICAgIHRoaXMub2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoXG4gICAgICAgIHRoaXMub25JbnRlcnNlY3Rpb24uYmluZCh0aGlzKSxcbiAgICAgICAgaW9Db25maWdcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub2JzZXJ2ZXIgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIGlzRW5hYmxlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5vYnNlcnZlciAhPT0gbnVsbDtcbiAgfVxuXG4gIG9uSW50ZXJzZWN0aW9uKG9ic2VydmVkRW50cmllcykge1xuICAgIG9ic2VydmVkRW50cmllcy5mb3JFYWNoKChlbnRyeSkgPT4ge1xuICAgICAgaWYgKGVudHJ5LmlzSW50ZXJzZWN0aW5nKSB7XG4gICAgICAgIGlmICh0aGlzLmNhbGxiYWNrKGVudHJ5LnRhcmdldCkgIT09IGZhbHNlKSB7XG4gICAgICAgICAgdGhpcy5vYnNlcnZlci51bm9ic2VydmUoZW50cnkudGFyZ2V0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIG9ic2VydmVFbnRyeShlbnRyeSkge1xuICAgIHRoaXMub2JzZXJ2ZXIub2JzZXJ2ZShlbnRyeSk7XG4gIH1cblxuICBzdGF0aWMgbG9hZFBpY3R1cmUoZW50cnkpIHtcbiAgICBlbnRyeS5xdWVyeVNlbGVjdG9yQWxsKCdzb3VyY2UnKS5mb3JFYWNoKChzb3VyY2UpID0+IHtcbiAgICAgIHNvdXJjZS5zZXRBdHRyaWJ1dGUoJ3NyY3NldCcsIHNvdXJjZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtc3Jjc2V0JykpO1xuICAgIH0pO1xuICAgIGNvbnN0IGltZyA9IGVudHJ5LnF1ZXJ5U2VsZWN0b3IoJ2ltZycpO1xuICAgIGltZy5zZXRBdHRyaWJ1dGUoJ3NyYycsIGltZy5nZXRBdHRyaWJ1dGUoJ2RhdGEtc3JjJykpO1xuICAgIHJldHVybiB0cnVlO1xuICB9O1xufVxuXG4vKiogSURCIGNhY2hlXG4gKiBXcmFwcGVyIG9iamVjdCB0byBzdG9yZSBhbmQgcmV0cmlldmUgb2JqZWN0cyBiYXNlZCBvbiBpZCBmcm9tIEluZGV4ZWREQlxuKi9cbmNsYXNzIE9iamVjdENhY2hlIHtcbiAgY29uc3RydWN0b3IoY2FjaGVuYW1lLCBhdXRvSW5jcmVtZW50ID0gZmFsc2UpIHtcbiAgICB0aGlzLmNhY2hlbmFtZSA9IGNhY2hlbmFtZTtcbiAgICB0aGlzLm9wZW5EYihhdXRvSW5jcmVtZW50KTtcbiAgfVxuXG4gIG9wZW5EYihhdXRvSW5jcmVtZW50ID0gZmFsc2UpIHtcbiAgICB0aGlzLmNhY2hlID0gaWRiLm9wZW4odGhpcy5jYWNoZW5hbWUsIDEsICh1cGdyYWRlRGIpID0+IHtcbiAgICAgIHN3aXRjaCAodXBncmFkZURiLm9sZFZlcnNpb24pIHtcbiAgICAgICAgY2FzZSAwOlxuICAgICAgICAgIGNvbnN0IHN0b3JlID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdjYWNoZScsIHtcbiAgICAgICAgICAgIGtleVBhdGg6ICdpZCcsXG4gICAgICAgICAgICBhdXRvSW5jcmVtZW50OiBhdXRvSW5jcmVtZW50XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgc3RvcmUuY3JlYXRlSW5kZXgoJ2J5LWlkJywgJ2lkJyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBnZXRBbGwoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2FjaGUudGhlbigoZGIpID0+IHtcbiAgICAgIHJldHVybiBkYi50cmFuc2FjdGlvbignY2FjaGUnKVxuICAgICAgICAub2JqZWN0U3RvcmUoJ2NhY2hlJykuaW5kZXgoJ2J5LWlkJylcbiAgICAgICAgLmdldEFsbCgpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIGdldCBhbGwgZWxlbWVudHMgYW5kIGRlbGV0ZSB0aGVtIGZyb20gdGhlIGRiXG4gICAqL1xuICB0YWtlQWxsKCkge1xuICAgIGNvbnN0IGl0ZW1zID0gW107XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuY2FjaGUudGhlbigoZGIpID0+IHtcbiAgICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbignY2FjaGUnLCAncmVhZHdyaXRlJyk7XG4gICAgICAgIHR4Lm9iamVjdFN0b3JlKCdjYWNoZScpLmluZGV4KCdieS1pZCcpLml0ZXJhdGVDdXJzb3IoKGN1cnNvcikgPT4ge1xuICAgICAgICAgIGlmICghY3Vyc29yKSByZXR1cm47XG4gICAgICAgICAgaXRlbXMucHVzaChjdXJzb3IudmFsdWUpO1xuICAgICAgICAgIGN1cnNvci5kZWxldGUoKTtcbiAgICAgICAgICBjdXJzb3IuY29udGludWUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHR4LmNvbXBsZXRlLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJlc29sdmUoaXRlbXMpO1xuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldChpZCkge1xuICAgIHJldHVybiB0aGlzLmNhY2hlLnRoZW4oKGRiKSA9PiB7XG4gICAgICByZXR1cm4gZGIudHJhbnNhY3Rpb24oJ2NhY2hlJylcbiAgICAgICAgLm9iamVjdFN0b3JlKCdjYWNoZScpLmdldChpZCk7XG4gICAgfSk7XG4gIH1cblxuICBwdXRBbGwob2JqZWN0cykge1xuICAgIHRoaXMuY2FjaGUudGhlbigoZGIpID0+IHtcbiAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ2NhY2hlJywgJ3JlYWR3cml0ZScpO1xuICAgICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgnY2FjaGUnKTtcbiAgICAgIG9iamVjdHMuZm9yRWFjaCgob2JqZWN0KSA9PiB7XG4gICAgICAgIHN0b3JlLnB1dChvYmplY3QpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwdXQob2JqZWN0KSB7XG4gICAgdGhpcy5wdXRBbGwoW29iamVjdF0pO1xuICB9XG5cbiAgZGVsZXRlKGlkKSB7XG4gICAgdGhpcy5jYWNoZS50aGVuKChkYikgPT4ge1xuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbignY2FjaGUnLCAncmVhZHdyaXRlJyk7XG4gICAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdjYWNoZScpO1xuICAgICAgc3RvcmUuZGVsZXRlKGlkKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiLyoqXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cbiAqL1xuY29uc3QgcmVzdGF1cmFudHNDYWNoZSA9IG5ldyBPYmplY3RDYWNoZSgncmVzdGF1cmFudHMnKTtcbmNvbnN0IHJldmlld3NDYWNoZSA9IG5ldyBPYmplY3RDYWNoZSgncmV2aWV3cycpO1xuXG5pZiAoJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvcikge1xuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgKGV2ZW50KSA9PiB7XG4gICAgaWYgKGV2ZW50LmRhdGEubWVzc2FnZSA9PT0gJ2NhY2hlX3JlZnJlc2gnKSB7XG4gICAgICAvLyB0cnkgdG8gdXBkYXRlIGNhY2hlXG4gICAgICBjb25zdCBjYWNoZWluZm8gPSBldmVudC5kYXRhLmNhY2hlaW5mbztcbiAgICAgIGlmIChjYWNoZWluZm8udGFyZ2V0ID09PSAncmVzdGF1cmFudCcpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3VwZGF0aW5nIHJlc3RhdXJhbnQnLCBjYWNoZWluZm8uaWQpO1xuICAgICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKGNhY2hlaW5mby5pZCwgKCkgPT4ge30pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3VwZGF0aW5nIHJldmlld3MnLCBjYWNoZWluZm8uaWQpO1xuICAgICAgICBEQkhlbHBlci5mZXRjaFJldmlld3MoY2FjaGVpbmZvLmlkLCAoKSA9PiB7fSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn07XG5cbmNsYXNzIERCSGVscGVyIHtcbiAgLyoqXG4gICAqIERhdGFiYXNlIFVSTC5cbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxuICAgKi9cbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XG4gICAgcmV0dXJuICdodHRwOi8vbG9jYWxob3N0OjEzMzcnO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgcmVzdGF1cmFudHMgZnJvbSBjYWNoZSB3aXRob3V0IGZldGNoIGFuZCBjYWNoZSB1cGRhdGVcbiAgICogV2FpdCB1bnRpbCBjYWNoZSBpcyBwb3B1bGF0ZWRcbiAgICovXG4gIHN0YXRpYyBnZXRSZXN0YXVyYW50cyhjYWxsYmFjaywgdGltZW91dCA9IDIwMCkge1xuICAgIHJlc3RhdXJhbnRzQ2FjaGUuZ2V0QWxsKCkudGhlbigob2JqZWN0cykgPT4ge1xuICAgICAgaWYgKG9iamVjdHMubGVuZ3RoIDwgMTApIHtcbiAgICAgICAgc2V0VGltZW91dCh0aGlzLmdldFJlc3RhdXJhbnRzKGNhbGxiYWNrLCB0aW1lb3V0ICogMiksIHRpbWVvdXQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgb2JqZWN0cyk7XG4gICAgICB9XG4gICAgfSlcbiAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgdGhpcy5mZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMgYW5kIHVwZGF0ZSBjYWNoZVxuICAgKi9cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcbiAgICByZXN0YXVyYW50c0NhY2hlLmdldEFsbCgpLnRoZW4oKG9iamVjdHMpID0+IHtcbiAgICAgIGlmIChvYmplY3RzLmxlbmd0aCA+PSAxMCkge1xuICAgICAgICBjYWxsYmFjayhudWxsLCBvYmplY3RzKTtcbiAgICAgICAgY2FsbGJhY2sgPSAoKSA9PiB7fTsgLy8gZG9uJ3QgY2FsbCBjYWxsYmFjayBhZ2FpbiBmcm9tIGZldGNoXG4gICAgICB9XG4gICAgICBmZXRjaCh0aGlzLkRBVEFCQVNFX1VSTCArICcvcmVzdGF1cmFudHMnKS50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICByZXNwb25zZS5qc29uKCkudGhlbigoanNvbikgPT4ge1xuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGpzb24pO1xuICAgICAgICAgIHJlc3RhdXJhbnRzQ2FjaGUucHV0QWxsKGpzb24pO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyb3IpID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIHJldmlld3MgYW5kIHVwZGF0ZSBjYWNoZVxuICAgKi9cbiAgc3RhdGljIGZldGNoUmV2aWV3cyhyZXN0YXVyYW50SWQsIGNhbGxiYWNrKSB7XG4gICAgcmV2aWV3c0NhY2hlLmdldEFsbCgpLnRoZW4oKG9iamVjdHMpID0+IHtcbiAgICAgIGlmIChvYmplY3RzLmxlbmd0aCA+PSAxKSB7XG4gICAgICAgIGNvbnN0IHJldmlld3MgPSBvYmplY3RzLmZpbHRlcihcbiAgICAgICAgICAoZWwpID0+IGVsWydyZXN0YXVyYW50X2lkJ10gPT0gcmVzdGF1cmFudElkXG4gICAgICAgICk7XG4gICAgICAgIGlmIChyZXZpZXdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKTtcbiAgICAgICAgICBjYWxsYmFjayA9ICgpID0+IHt9OyAvLyBkb24ndCByZXBlYXQgY2FsbGJhY2sgb24gZmV0Y2hcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZmV0Y2godGhpcy5EQVRBQkFTRV9VUkwgKyAnL3Jldmlld3MvP3Jlc3RhdXJhbnRfaWQ9JyArIHJlc3RhdXJhbnRJZClcbiAgICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICByZXNwb25zZS5qc29uKCkudGhlbigoanNvbikgPT4ge1xuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGpzb24pO1xuICAgICAgICAgIHJldmlld3NDYWNoZS5wdXRBbGwoanNvbik7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IGNhbGxiYWNrKGVycm9yLCBudWxsKSk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnJvcikgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxuICAgKi9cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XG4gICAgbGV0IGdvdEZyb21DYWNoZSA9IGZhbHNlO1xuICAgIHJlc3RhdXJhbnRzQ2FjaGUuZ2V0KHBhcnNlSW50KGlkKSkudGhlbigob2JqZWN0KSA9PiB7XG4gICAgICBpZiAodHlwZW9mIG9iamVjdCA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgZ290RnJvbUNhY2hlID0gdHJ1ZTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgb2JqZWN0KTtcbiAgICAgIH1cbiAgICAgIGlmIChnb3RGcm9tQ2FjaGUpIHtcbiAgICAgICAgY2FsbGJhY2sgPSAoKSA9PiB7fTtcbiAgICAgIH1cbiAgICAgIGZldGNoKHRoaXMuREFUQUJBU0VfVVJMICsgJy9yZXN0YXVyYW50cy8nICsgaWQpLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKChqc29uKSA9PiB7XG4gICAgICAgICAgICBjYWxsYmFjayhudWxsLCBqc29uKTtcbiAgICAgICAgICAgIHJlc3RhdXJhbnRzQ2FjaGUucHV0KGpzb24pO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4gY2FsbGJhY2soZXJyb3IsIG51bGwpKTtcbiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgICAgIGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2FsbGJhY2socmVzcG9uc2Uuc3RhdHVzVGV4dCwgbnVsbCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiBjYWxsYmFjayhlcnJvciwgbnVsbCkpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKChyKSA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIoXG4gICAgICAgICAgKHIpID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZFxuICAgICAgICApO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kXG4gICAqIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLFxuICAgIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcigocikgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKChyKSA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmdldFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcChcbiAgICAgICAgICAodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kXG4gICAgICAgICk7XG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoXG4gICAgICAgICAgKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpXG4gICAgICAgICk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgREJIZWxwZXIuZ2V0UmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSk7XG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoXG4gICAgICAgICAgKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaVxuICAgICAgICApO1xuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cbiAgICovXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XG4gIH1cblxuICAvKipcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXG4gICAqL1xuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofWApO1xuICB9XG5cbiAgLyoqXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cbiAgICovXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxuICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcbiAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcbiAgICAgIG1hcDogbWFwLFxuICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUCB9XG4gICAgKTtcbiAgICByZXR1cm4gbWFya2VyO1xuICB9XG5cbiAgLyoqXG4gICAqIFRvZ2dsZSBmYXZvcml0ZVxuICAgKi9cbiAgc3RhdGljIHRvZ2dsZVJlc3RhdXJhbnRGYXZvcml0ZShpZCwgZmF2b3JpdGUpIHtcbiAgICByZXR1cm4gZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMICtcbiAgICAgIGAvcmVzdGF1cmFudHMvJHtpZH0vP2lzX2Zhdm9yaXRlPSR7ZmF2b3JpdGV9YCxcbiAgICAgIHsgbWV0aG9kOiAnUFVUJyB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgbmV3IHJlc3RhdXJhbnQgcmV2aWV3XG4gICAqL1xuICBzdGF0aWMgYWRkUmVzdGF1cmFudFJldmlldyhyZXZpZXcpIHtcbiAgICByZXR1cm4gZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMICsgJy9yZXZpZXdzLycsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmV2aWV3KVxuICAgIH0pO1xuICB9XG59XG4iLCJsZXQgcmVzdGF1cmFudHM7XG5sZXQgbmVpZ2hib3Job29kcztcbmxldCBjdWlzaW5lcztcbnZhciBtYXA7XG52YXIgbWFya2VycyA9IFtdO1xuXG5kb2N1bWVudC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAoKSA9PiB7XG4gIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlID09PSAnaW50ZXJhY3RpdmUnKSB7XG4gICAgdXBkYXRlUmVzdGF1cmFudHMoKTtcbiAgfVxufTtcblxuLyoqXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG4gIGZldGNoQ3Vpc2luZXMoKTtcbiAgaW5pdGlhbGl6ZU1hcFRvZ2dsZSgpO1xuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcjbmVpZ2hib3Job29kcy1zZWxlY3QsI2N1aXNpbmVzLXNlbGVjdCcpLmZvckVhY2goXG4gICAgKGVsKSA9PiB7XG4gICAgICBlbC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB1cGRhdGVSZXN0YXVyYW50cyk7XG4gICAgfVxuICApO1xufSk7XG5cbi8qKlxuICogQWRkIGV2ZW50IGxpc3RlbmVyIHRvIHRvZ2dsZS1tYXAgbGlua1xuICovXG5jb25zdCBpbml0aWFsaXplTWFwVG9nZ2xlID0gKCkgPT4ge1xuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjdG9nZ2xlLW1hcCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICBjb25zdCBtYXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbWFwLWNvbnRhaW5lcicpO1xuICAgIGlmIChldmVudC50YXJnZXQuZGF0YXNldC5zaG93ID09PSAnZmFsc2UnKSB7XG4gICAgICBldmVudC50YXJnZXQuaW5uZXJIVE1MID0gJ0hpZGUgcmVzdWx0cyBtYXAnO1xuICAgICAgZXZlbnQudGFyZ2V0LmRhdGFzZXQuc2hvdyA9ICd0cnVlJztcbiAgICAgIGNvbnN0IG1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21hcFNjcmlwdCcpO1xuICAgICAgaWYgKG51bGwgPT09IG1zKSB7XG4gICAgICAgIGNvbnN0IGFkZE1zID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgICAgIGFkZE1zLmlkID0gJ21hcFNjcmlwdCc7XG4gICAgICAgIGFkZE1zLnNyYyA9ICdodHRwczovL21hcHMuZ29vZ2xlYXBpcy5jb20vbWFwcy9hcGkvanM/a2V5PUFJemFTeUNXWWZXSzR4MkFXenpOVzFCNllxZU1nOUpSbUJSQnlnVSZsaWJyYXJpZXM9cGxhY2VzJmNhbGxiYWNrPWluaXRNYXAnO1xuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdoZWFkJykuYXBwZW5kKGFkZE1zKTtcbiAgICAgIH1cbiAgICAgIGlmIChzZWxmLm1hcmtlcnMubGVuZ3RoID09IDApIHtcbiAgICAgICAgYWRkTWFya2Vyc1RvTWFwKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGV2ZW50LnRhcmdldC5pbm5lckhUTUwgPSAnU2hvdyByZXN1bHRzIG9uIG1hcCc7XG4gICAgICBldmVudC50YXJnZXQuZGF0YXNldC5zaG93ID0gJ2ZhbHNlJztcbiAgICB9XG4gICAgbWFwLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpO1xuICB9KTtcbn07XG5cbi8qKlxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG5jb25zdCBmZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIG5laWdoYm9yaG9vZHMpID0+IHtcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5uZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcztcbiAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXG4gKi9cbmNvbnN0IGZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuICBuZWlnaGJvcmhvb2RzLmZvckVhY2goKG5laWdoYm9yaG9vZCkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XG4gICAgb3B0aW9uLnZhbHVlID0gbmVpZ2hib3Job29kO1xuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcbiAgfSk7XG59O1xuXG4vKipcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cbmNvbnN0IGZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XG4gIERCSGVscGVyLmZldGNoQ3Vpc2luZXMoKGVycm9yLCBjdWlzaW5lcykgPT4ge1xuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5jdWlzaW5lcyA9IGN1aXNpbmVzO1xuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxuICovXG5jb25zdCBmaWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3Vpc2luZXMtc2VsZWN0Jyk7XG5cbiAgY3Vpc2luZXMuZm9yRWFjaCgoY3Vpc2luZSkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn07XG5cbi8qKlxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxuICovXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgbGV0IGxvYyA9IHtcbiAgICBsYXQ6IDQwLjcyMjIxNixcbiAgICBsbmc6IC03My45ODc1MDFcbiAgfTtcbiAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgIHpvb206IDEyLFxuICAgIGNlbnRlcjogbG9jLFxuICAgIHNjcm9sbHdoZWVsOiBmYWxzZVxuICB9KTtcbiAgc2VsZi5tYXAuYWRkTGlzdGVuZXIoJ3RpbGVzbG9hZGVkJywgc2V0TWFwVGl0bGUpO1xuICBhZGRNYXJrZXJzVG9NYXAoKTtcbn07XG5cbi8qKlxuICogU2V0IHRpdGxlIG9mIG1hcCBpZnJhbWVcbiAqL1xuY29uc3Qgc2V0TWFwVGl0bGUgPSAoKSA9PiB7XG4gIGNvbnN0IG1hcEZyYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI21hcCcpLnF1ZXJ5U2VsZWN0b3IoJ2lmcmFtZScpO1xuICBtYXBGcmFtZS5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgJ0dvb2dsZSBtYXBzIHdpdGggcmVzdGF1cmFudCBsb2NhdGlvbicpO1xufTtcblxuLyoqXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxuICovXG5jb25zdCB1cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcblxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLFxuICAgIChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHMpO1xuICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cbiAqL1xuY29uc3QgcmVzZXRSZXN0YXVyYW50cyA9IChyZXN0YXVyYW50cykgPT4ge1xuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICB1bC5pbm5lckhUTUwgPSAnJztcblxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKChtKSA9PiBtLnNldE1hcChudWxsKSk7XG4gIHNlbGYubWFya2VycyA9IFtdO1xuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XG59O1xuXG4vKipcbiAqIFNldCBpbm5lciBodG1sIGFuZCBzY3JlZW4gcmVhZGVyIGxhYmVsIG9mIGFuIGVsZW1lbnRcbiAqL1xuY29uc3Qgc2V0dXBFbGVtZW50V2l0aExhYmVsID0gKGVsZW1lbnQsIGxhYmVsLCB0ZXh0KSA9PiB7XG4gIGNvbnN0IGxhYmVsRSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgbGFiZWxFLmNsYXNzTmFtZSA9ICdzci1vbmx5JztcbiAgbGFiZWxFLmlubmVySFRNTCA9IGxhYmVsO1xuICBlbGVtZW50LmFwcGVuZChsYWJlbEUpO1xuICBjb25zdCB0ZXh0RSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHRleHQpO1xuICBlbGVtZW50LmFwcGVuZCh0ZXh0RSk7XG4gIHJldHVybiBlbGVtZW50O1xufTtcblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jb25zdCBmaWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XG4gIGNvbnN0IGxhenkgPSBuZXcgTGF6eUxvYWRlcihMYXp5TG9hZGVyLmxvYWRQaWN0dXJlKTtcbiAgcmVzdGF1cmFudHMuZm9yRWFjaCgocmVzdGF1cmFudCkgPT4ge1xuICAgIGNvbnN0IHJlc3RFbnRyeSA9IGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpO1xuICAgIGlmIChsYXp5LmlzRW5hYmxlZCkge1xuICAgICAgbGF6eS5vYnNlcnZlRW50cnkocmVzdEVudHJ5KTtcbiAgICB9IGVsc2Uge1xuICAgICAgTGF6eUxvYWRlci5sb2FkUGljdHVyZShyZXN0RW50cnkpO1xuICAgIH1cbiAgICB1bC5hcHBlbmQocmVzdEVudHJ5KTtcbiAgfSk7XG4gIGFkZE1hcmtlcnNUb01hcCgpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcGljdHVyZSB0YWcgZm9yIHJlc3BvbnNpdmUgYW5kIG9wdGltaXplZCBpbWFnZXNcbiAqL1xuY29uc3QgY3JlYXRlUGljdHVyZVRhZyA9IChyZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGltZ0Jhc2UgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIGNvbnN0IHBpY3R1cmVUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwaWN0dXJlJyk7XG4gIGNvbnN0IHJlc3BvbnNpdmVTZXQgPSBbXG4gICAge1xuICAgICAgbWVkaWE6ICcobWF4LXdpZHRoOiA0MDBweCknLFxuICAgICAgc3Jjc2V0OiBbJ0A0MDAuanBnIDF4JywgJy5qcGcgMngnXVxuICAgIH0sXG4gICAge1xuICAgICAgbWVkaWE6ICcobWF4LXdpZHRoOiA1NDlweCknLFxuICAgICAgc3Jjc2V0OiBbJ0A1NTAuanBnIDF4JywgJy5qcGcgMngnXVxuICAgIH0sXG4gICAge1xuICAgICAgbWVkaWE6ICcobWluLXdpZHRoOiA1NTBweCknLFxuICAgICAgc3Jjc2V0OiBbJ0A0MDAuanBnIDF4JywgJy5qcGcgMngnXVxuICAgIH1cbiAgXTtcbiAgcmVzcG9uc2l2ZVNldC5mb3JFYWNoKChzZXQpID0+IHtcbiAgICBjb25zdCBzb3VyY2VUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkYXRhLXNvdXJjZScpO1xuICAgIHNvdXJjZVRhZy5zZXRBdHRyaWJ1dGUoJ21lZGlhJywgc2V0Lm1lZGlhKTtcbiAgICBjb25zdCBzcmNzZXQgPSBbXTtcbiAgICBzZXQuc3Jjc2V0LmZvckVhY2goKGltZykgPT4ge1xuICAgICAgc3Jjc2V0LnB1c2goYCR7aW1nQmFzZX0ke2ltZ31gKTtcbiAgICB9KTtcbiAgICBzb3VyY2VUYWcuc2V0QXR0cmlidXRlKCdzcmNzZXQnLCBzcmNzZXQuam9pbignLCAnKSk7XG4gICAgcGljdHVyZVRhZy5hcHBlbmQoc291cmNlVGFnKTtcbiAgfSk7XG4gIGNvbnN0IGltZ1RhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICBpbWdUYWcuc2V0QXR0cmlidXRlKCdkYXRhLXNyYycsIGAke2ltZ0Jhc2V9QDU1MC5qcGdgKTtcbiAgaW1nVGFnLnNldEF0dHJpYnV0ZSgnYWx0JywgJ1Jlc3RhdXJhbnQgJyArIHJlc3RhdXJhbnQubmFtZSk7XG4gIHBpY3R1cmVUYWcuYXBwZW5kKGltZ1RhZyk7XG4gIHJldHVybiBwaWN0dXJlVGFnO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxuICovXG5jb25zdCBjcmVhdGVSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgbGkuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtY29udGFpbmVyJztcblxuICBjb25zdCBpbWdkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgaW1nZGl2LmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG4gIGltZ2Rpdi5hcHBlbmQoY3JlYXRlUGljdHVyZVRhZyhyZXN0YXVyYW50KSk7XG4gIGxpLmFwcGVuZChpbWdkaXYpO1xuXG4gIGNvbnN0IHN1bW1hcnlkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgc3VtbWFyeWRpdi5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1zdW1tYXJ5JztcblxuICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gIHRpdGxlLmFwcGVuZENoaWxkKGNyZWF0ZUZhdm9yaXRlVG9nZ2xlKHJlc3RhdXJhbnQpKTtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHJlc3RhdXJhbnQubmFtZSk7XG4gIHRpdGxlLmFwcGVuZENoaWxkKG5hbWUpO1xuICBzdW1tYXJ5ZGl2LmFwcGVuZCh0aXRsZSk7XG5cbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBuZWlnaGJvcmhvb2QuY2xhc3NOYW1lID0gJ25laWdoYm9yaG9vZCBwaWxsJztcbiAgc3VtbWFyeWRpdi5hcHBlbmQoXG4gICAgc2V0dXBFbGVtZW50V2l0aExhYmVsKG5laWdoYm9yaG9vZCxcbiAgICAgICdOZWlnaGJvcmhvb2Q6JyxcbiAgICAgIHJlc3RhdXJhbnQubmVpZ2hib3Job29kXG4gICAgKVxuICApO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGFkZHJlc3MuY2xhc3NOYW1lID0gJ2FkZHJlc3MnO1xuICBzdW1tYXJ5ZGl2LmFwcGVuZChcbiAgICBzZXR1cEVsZW1lbnRXaXRoTGFiZWwoYWRkcmVzcywgJ0FkZHJlc3M6JywgcmVzdGF1cmFudC5hZGRyZXNzKVxuICApO1xuXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gIG1vcmUuaW5uZXJIVE1MID0gJ1ZpZXcgRGV0YWlscyc7XG4gIG1vcmUuaHJlZiA9IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG4gIG1vcmUuY2xhc3NOYW1lID0gJ2J1dHRvbic7XG4gIG1vcmUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ1ZpZXcgZGV0YWlscyBvZiAnICsgcmVzdGF1cmFudC5uYW1lKTtcbiAgc3VtbWFyeWRpdi5hcHBlbmQobW9yZSk7XG5cbiAgbGkuYXBwZW5kKHN1bW1hcnlkaXYpO1xuXG4gIHJldHVybiBsaTtcbn07XG5cbi8qKlxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cbiAqL1xuY29uc3QgYWRkTWFya2Vyc1RvTWFwID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xuICBpZiAodHlwZW9mIGdvb2dsZSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgcmVzdGF1cmFudHMuZm9yRWFjaCgocmVzdGF1cmFudCkgPT4ge1xuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsO1xuICAgIH0pO1xuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XG4gIH0pO1xufTtcblxuY29uc3QgY3JlYXRlRmF2b3JpdGVUb2dnbGUgPSAocmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gIGJ1dHRvbi5ocmVmPScjJztcbiAgYnV0dG9uLmNsYXNzTmFtZSA9ICdmYXZvcml0ZS10b2dnbGUnO1xuICBidXR0b24uc2V0QXR0cmlidXRlKCdkYXRhLXJlc3RhdXJhbnQtaWQnLCByZXN0YXVyYW50LmlkKTtcbiAgYnV0dG9uLnNldEF0dHJpYnV0ZSgncm9sZScsICdzd2l0Y2gnKTtcbiAgY29uc3QgY2hlY2sgPSByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09PSAndHJ1ZScgPyAndHJ1ZScgOiAnZmFsc2UnO1xuICBidXR0b24uc2V0QXR0cmlidXRlKCdhcmlhLWNoZWNrZWQnLCBjaGVjayk7XG4gIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgJ1RvZ2dsZSBmYXZvcml0ZSBzdGF0dXMgb2YgJyArXG4gIHJlc3RhdXJhbnQubmFtZSk7XG4gIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnVG9nZ2xlIGZhdm9yaXRlIHN0YXR1cyBvZiAnICtcbiAgcmVzdGF1cmFudC5uYW1lKTtcbiAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdG9nZ2xlRmF2b3JpdGVIYW5kbGVyKTtcbiAgcmV0dXJuIGJ1dHRvbjtcbn07XG5cbmNvbnN0IHRvZ2dsZUZhdm9yaXRlSGFuZGxlciA9IChldmVudCkgPT4ge1xuICBjb25zdCB0YXJnZXQgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICBjb25zdCBySWQgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdkYXRhLXJlc3RhdXJhbnQtaWQnKTtcbiAgY29uc3QgY2hlY2sgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdhcmlhLWNoZWNrZWQnKSA9PT0gJ2ZhbHNlJ1xuICA/ICd0cnVlJyA6ICdmYWxzZSc7XG4gIERCSGVscGVyLnRvZ2dsZVJlc3RhdXJhbnRGYXZvcml0ZShySWQsIGNoZWNrKVxuICAudGhlbigoKSA9PiB7XG4gICAgdGFyZ2V0LnNldEF0dHJpYnV0ZSgnYXJpYS1jaGVja2VkJywgY2hlY2spO1xuICB9KTtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn07XG4iXX0=
